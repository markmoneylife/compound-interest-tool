<!-- âœ… ETF é…æ¯åœ–å¡ç€‘å¸ƒç‰†ï½œWordPress å…§æ–‡å°ˆç”¨ç‰ˆæœ¬ -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  /* åªé‡å°é€™ä¸€å¡Šï¼Œä¸å»å‹•æ•´å€‹ç¶²ç«™çš„ body */
  .etf-wall-shell {
    background: #F5F2E9;
    color: #1F2933;
    border-radius: 1.5rem;
    padding: 2rem 1.25rem 2.5rem;
    max-width: 1080px;
    margin: 2rem auto 0;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
    border: 1px solid rgba(148, 163, 184, 0.35);
  }

  @media (min-width: 768px) {
    .etf-wall-shell {
      padding: 2.5rem 2.5rem 3rem;
    }
  }

  /* å€å¡Šå°æ¨™ï¼‹èªªæ˜ï¼Œæ¥è¿‘é¦–é é¢¨æ ¼ */
  .etf-wall-badge {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
    padding: .3rem .7rem;
    border-radius: 999px;
    font-size: .68rem;
    font-weight: 600;
    letter-spacing: .08em;
    text-transform: uppercase;
    background: rgba(22, 101, 52, 0.07);
    color: #166534;
    border: 1px solid rgba(22, 101, 52, 0.25);
  }

  .etf-wall-title-main {
    font-size: 1.6rem;
    font-weight: 800;
    color: #1D4A35;
    margin-top: .6rem;
    margin-bottom: .25rem;
  }

  .etf-wall-subtitle {
    font-size: 0.95rem;
    color: #4B5563;
    max-width: 30rem;
  }

  /* æ”¶ç›Šçµ„æˆå¡ç‰‡å„ªåŒ–ï¼ˆç¶­æŒä½ åŸæœ¬çš„è³‡æ–™æ¬„ä½ï¼‰ */
  .card-common {
    background: linear-gradient(135deg, #EAF4F1 0%, #FFFAF0 100%);
    border: 1px solid rgba(23, 68, 59, 0.2);
    border-radius: 1rem;
    box-shadow: 0 10px 15px rgba(15, 23, 42, 0.12);
    padding: 1.35rem;
    color: #17453B;
    transition: transform .18s ease-out, box-shadow .18s ease-out, border-color .18s;
    position: relative;
    overflow: hidden;
  }
  .card-common:hover {
    transform: translateY(-3px);
    box-shadow: 0 16px 30px rgba(15, 23, 42, 0.2);
    border-color: rgba(56, 189, 248, 0.6);
  }
  .card-common h3 {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.1rem;
  }
  .card-common .etf-name {
    font-size: 0.8rem;
    color: #4B5563;
    margin-bottom: 0.8rem;
  }
  .card-common .highlight {
    background: rgba(255, 255, 255, 0.96);
    padding: 0.55rem 0.5rem;
    border-radius: 0.75rem;
    box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.35);
  }

  /* å…¥å¸³æ™‚é–“è¡¨å¤–è§€ */
  .etf-timeline-card {
    background: #FFF9E0;
    border-radius: 1rem;
    padding: 1rem 1.1rem;
    box-shadow: 0 10px 20px rgba(148, 163, 184, 0.35);
  }

  /* å°å­—æç¤º */
  .etf-note {
    font-size: 0.75rem;
    color: #6B7280;
  }
</style>

<div class="etf-wall-shell">
  <!-- é ‚éƒ¨ç°¡çŸ­ Heroï¼Œè·Ÿé »é“é¦–é èªæ°£æ¥è»Œ -->
  <section class="mb-8">
    <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div>
        <span class="etf-wall-badge">
          ETF é…æ¯ Â· ç¾é‡‘æµ Â· å­˜è‚¡ç”Ÿæ´»
        </span>
        <h2 class="etf-wall-title-main">
          ETF é…æ¯åœ–å¡ç€‘å¸ƒç‰†ï½œä¸€çœ¼çœ‹æ‡‚æ¯æœˆç¾é‡‘æµ
        </h2>
        <p class="etf-wall-subtitle">
          æŠŠæ¯æª” ETF çš„é…æ¯ï¼Œç”¨åœ–å¡æ’æˆã€Œç€‘å¸ƒã€ã€‚ä½ ä¸ç”¨ç¿»å…¬å‘Šï¼Œåªè¦çœ‹é€™ä¸€é ï¼Œ
          å°±çŸ¥é“é€™å€‹æœˆèª°åœ¨é…ã€é…å¤šå°‘ã€ä»€éº¼æ™‚å€™éŒ¢æœƒé€²ä¾†ã€‚
        </p>
      </div>
      <div class="mt-3 md:mt-0 flex flex-col items-start md:items-end gap-2">
        <a href="https://markmoneylife.github.io/compound-interest-tool/"
           target="_blank" rel="noopener"
           class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-semibold border border-emerald-500/60 text-emerald-700 bg-white hover:bg-emerald-50">
          ğŸ§° å›è¤‡åˆ©å·¥å…·ç®±ï¼Œæ’æ•´é«”è³‡ç”¢é…ç½®
        </a>
        <p class="etf-note">
          å°æé†’ï¼šé…æ¯æ˜¯ç¾é‡‘æµï¼Œä¸ç­‰æ–¼ä½ çœŸçš„è³ºåˆ°é‚£éº¼å¤šå ±é…¬ï¼Œè¨˜å¾—æ­é…ã€Œç¸½å ±é…¬ã€ä¸€èµ·çœ‹ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- ETFç€‘å¸ƒç‰†ä¸»é«” -->
  <section id="wall" class="max-w-5xl mx-auto">
    <div class="text-center mb-4">
      <p class="text-xs text-gray-500 mb-1">
        è³‡æ–™ä¾†æºï¼š
        <a href="https://www.twse.com.tw/zh/ETFortune/announcementList"
           class="underline text-blue-600" target="_blank" rel="noopener">
          è‡ºç£è­‰åˆ¸äº¤æ˜“æ‰€ ETF é…æ¯å…¬å‘Š
        </a>
      </p>
      <div id="last-update" class="text-center text-xs text-gray-400"></div>
    </div>

    <!-- æ¨¡å¼åˆ‡æ› -->
    <div id="mode-switch" class="text-center my-6">
      <button data-mode="forecast"
              class="px-4 py-2 mx-2 rounded-full bg-[#1D4A35] text-[#FFD54F] text-sm font-semibold shadow">
        é ä¼°é…æ¯æ¨¡å¼
      </button>
      <button data-mode="distribution"
              class="px-4 py-2 mx-2 rounded-full bg-gray-200 text-gray-700 text-sm font-semibold">
        æ”¶ç›Šçµ„æˆæ¨¡å¼
      </button>
    </div>

    <!-- ğŸ”¹ ä½ çš„ETFé€™æœŸé…å¤šå°‘ï¼Ÿè©¦ç®—å€ -->
    <section id="my-dividend"
             class="max-w-3xl mx-auto mb-10 bg-white/95 rounded-2xl shadow-md border border-emerald-100 p-5">
      <h3 class="text-xl font-bold text-[#1D4A35] mb-2">ä½ çš„ ETF é€™æœŸé…å¤šå°‘ï¼Ÿ</h3>
      <p class="text-sm text-gray-600 mb-4">
        è¼¸å…¥ ETF ä»£è™Ÿï¼‹æŒæœ‰å¼µæ•¸ï¼Œå¹«ä½ ä¼°ç®—æœ¬æœŸå¤§æ¦‚å¯ä»¥é ˜å¤šå°‘é…æ¯ï¼ˆä»¥ç•¶æœˆè³‡æ–™ç‚ºä¸»ï¼‰ï¼Œ
        é©åˆæ‹¿ä¾†è¦åŠƒæ¯æœˆç¾é‡‘æµï¼šå“ªå¤©å¯ä»¥ä»˜æˆ¿è²¸ã€å“ªå¤©å¯ä»¥åŠ ç¢¼å®šæœŸå®šé¡ã€‚
      </p>
      <div class="flex flex-col md:flex-row gap-4 items-center">
        <div class="w-full md:w-1/3">
          <label class="block text-xs text-gray-600 mb-1">ETF ä»£è™Ÿï¼ˆä¾‹å¦‚ï¼š00919ã€00713ï¼‰</label>
          <input id="my-dividend-code" type="text" placeholder="è«‹è¼¸å…¥ETFä»£è™Ÿ"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" />
        </div>
        <div class="w-full md:w-1/3">
          <label class="block text-xs text-gray-600 mb-1">æŒæœ‰å¼µæ•¸</label>
          <input id="my-dividend-lots" type="number" min="1" step="1" value="1"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" />
        </div>
        <div class="w-full md:w-1/3 flex items-end">
          <button id="my-dividend-btn"
                  class="w-full bg-[#1D4A35] text-[#FFD54F] font-semibold rounded-lg py-2 text-sm hover:bg-emerald-900 transition">
            ğŸ§® å¹«æˆ‘ç®—é€™æ¬¡å¯ä»¥é ˜å¤šå°‘
          </button>
        </div>
      </div>
      <div id="my-dividend-result" class="mt-4 text-sm text-gray-800 leading-relaxed"></div>
    </section>

    <!-- é ä¼°é…æ¯æ¨¡å¼ -->
    <div id="mode-forecast">
      <!-- å‰äº”åæ’è¡Œå¡ç‰‡ -->
      <div class="max-w-4xl mx-auto mb-8">
        <h3 class="text-xl font-semibold mb-2 text-center text-[#1D4A35]">ğŸ¥‡ å–®æœŸæ®–åˆ©ç‡å‰äº”å</h3>
        <p class="text-xs text-center text-gray-500 mb-3">
          åªçœ‹é€™ä¸€æœŸé…å¤šå°‘ï¼Œä¸ä»£è¡¨é•·æœŸä¸€å®šæ¯”è¼ƒå¥½ï¼Œé€™è£¡ç•¶æˆè§€å¯Ÿåå–®ï¼Œä¸æ˜¯å ±åç‰Œã€‚
        </p>
        <div id="top5-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"></div>
      </div>

      <div id="loading" class="text-center text-sm text-gray-500 mb-4">è¼‰å…¥ä¸­...</div>
      <div id="card-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <!-- æ”¶ç›Šçµ„æˆæ¨¡å¼ -->
    <div id="mode-distribution" class="max-w-6xl mx-auto" style="display:none;">
      <h3 class="text-2xl font-bold text-[#17453B] mb-3">ğŸ“Š æœ¬æœˆé…æ¯æ”¶ç›Šçµ„æˆ</h3>
      <p class="text-sm text-gray-600 mb-6">
        ä¸€æ¬¡çœ‹æ‡‚è‚¡åˆ©ã€åˆ©æ¯ã€å¹³æº–é‡‘ã€è³‡æœ¬åˆ©å¾—ã€å…¶ä»–æ‰€å¾—ï¼Œä»¥åŠå¥ä¿æ‡‰èª²å¼µæ•¸ã€‚
        é…æ¯çœ‹èµ·ä¾†å¾ˆé¦™æ²’éŒ¯ï¼Œä½†ä¹Ÿè¦çŸ¥é“ã€Œè£¡é¢æ˜¯ä»€éº¼ã€åœ¨æ’é€™å€‹æ®–åˆ©ç‡ã€‚
      </p>

      <!-- äºŒä»£å¥ä¿è£œå……ä¿è²»ç°¡æ˜“ç‰ˆ -->
      <section class="bg-gray-50 p-4 rounded-xl shadow-sm mb-6 border border-gray-200">
        <h4 class="text-lg font-bold mb-2 text-[#92400E]">äºŒä»£å¥ä¿è£œå……ä¿è²»ç°¡ä»‹ï¼ˆç°¡æ˜“ç‰ˆï¼‰</h4>
        <ul class="list-disc pl-5 space-y-1 text-xs md:text-sm text-gray-700">
          <li>è²»ç‡ç›®å‰ç‚º <span class="font-semibold">2.11ï¼…</span>ã€‚</li>
          <li>é‡å°ã€Œå–®æ¬¡çµ¦ä»˜ã€æˆ–ã€Œå·®é¡ã€åŠ å¾µï¼Œä¾‹å¦‚ï¼šå¹´çµ‚çé‡‘ã€ä¸€æ¬¡æ€§è‚¡åˆ©ã€åˆ©æ¯ç­‰ã€‚</li>
          <li>å–®æ¬¡çµ¦ä»˜é‡‘é¡ â‰¥ 20,000 å…ƒæ™‚ï¼Œæ‰æœƒè§¸ç™¼è£œå……ä¿éšªè²»ã€‚</li>
          <li>è‹¥ç¬¦åˆå¼±å‹¢æˆ–ä½æ”¶å…¥æ—ç¾¤è³‡æ ¼ï¼Œå¯å‘å¥ä¿å±€ç”³è«‹å…æ‰£ã€‚</li>
        </ul>
      </section>

      <!-- æ”¶ç›Šçµ„æˆå¡ç‰‡å®¹å™¨ -->
      <div id="composition-container" class="grid gap-6 auto-cols-fr md:grid-cols-2 lg:grid-cols-3"></div>
    </div>
  </section>

  <!-- é…æ¯æ™‚é–“è¡¨ -->
  <section id="timeline" class="max-w-3xl mx-auto mt-10">
    <h3 id="timeline-header" class="text-2xl font-bold text-center text-[#1D4A35] mb-3"></h3>
    <p class="text-center text-sm text-gray-600 mb-6">
      ä»¥ä¸‹ç‚ºæœ¬æœˆå¯¦éš›ç™¼æ”¾æ—¥è³‡æ–™ï¼Œæ–¹ä¾¿ä½ å®‰æ’ï¼šå“ªå¤©éŒ¢é€²ä¾†ã€å“ªå¤©è¦æ‰£æˆ¿è²¸ã€å¡è²»ã€æˆ–æ˜¯åŠ ç¢¼å®šæœŸå®šé¡ã€‚
    </p>
    <div id="dividendList"></div>
  </section>

  <!-- Footer å€å¡Šï¼ˆåªé‡å°å·¥å…·ï¼‰-->
  <footer class="mt-10 bg-white border border-gray-200 rounded-2xl py-6 px-4 md:px-6 text-gray-600 text-xs">
    <div class="max-w-4xl mx-auto grid gap-6 md:grid-cols-2">
      <!-- è³‡æ–™ä¾†æº & ä½œè€… -->
      <div class="flex flex-col space-y-2">
        <p class="flex items-center space-x-1">
          <span>ğŸ“Š è³‡æ–™ä¾†æºï¼š</span>
          <a href="https://www.twse.com.tw/zh/ETFortune/announcementList"
             target="_blank" rel="noopener"
             class="underline hover:text-gray-800">
            è‡ºç£è­‰åˆ¸äº¤æ˜“æ‰€ ETF é…æ¯å…¬å‘Š
          </a>
        </p>
        <p>ğŸ¬ æ•´ç†èˆ‡è¨­è¨ˆï¼šå³é¦¬å…‹ï¼ˆå¹¸ç¦ç†è²¡å®¶ï¼‰</p>
        <p>ğŸ’¡ å»ºè­°ï¼šæŠŠé€™é è¨­æˆæ›¸ç±¤ï¼Œç•¶æˆä½ æ¯æœˆã€Œé…æ¯æª¢æŸ¥é»ã€ã€‚</p>
      </div>

      <!-- æŠ•è³‡é¢¨éšªæç¤º -->
      <div class="space-y-2">
        <p class="font-semibold text-[#92400E]">ğŸ“¢ æŠ•è³‡é¢¨éšªæç¤ºï¼š</p>
        <ul class="list-disc list-inside space-y-1 leading-relaxed">
          <li>åŸºé‡‘é…æ¯ç‡â‰ å ±é…¬ç‡ï¼Œéå»é…æ¯ä¸ä»£è¡¨æœªä¾†ç¸¾æ•ˆã€‚</li>
          <li>æœ¬é è³‡æ–™åƒ…ä¾›æŠ•è³‡ç´€éŒ„åˆ†äº«èˆ‡ç†è²¡æ•™è‚²ï¼Œéå€‹åˆ¥åŒ–æŠ•è³‡å»ºè­°ã€‚</li>
          <li>ETF ç­‰é‡‘èå•†å“æœ‰æ¼²æœ‰è·Œï¼Œè«‹å¯©æ…è©•ä¼°è‡ªèº«é¢¨éšªæ‰¿å—åº¦ã€‚</li>
          <li>å¦‚éœ€å°ˆæ¥­å»ºè­°ï¼Œè«‹è«®è©¢åˆæ ¼é‡‘èé¡§å•ã€‚</li>
        </ul>
      </div>
    </div>

    <!-- å›åˆ°é ‚éƒ¨ -->
    <p class="mt-6 text-center">
      <a href="#wall"
         class="inline-block hover:underline">
        â†‘ å›åˆ°ä¸Šæ–¹ç€‘å¸ƒç‰†ï¼Œæ›å¦ä¸€æª” ETF çœ‹çœ‹
      </a>
    </p>
  </footer>
</div>

<script>
  const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSYJzDEa1_U_eq_Wh_Sr6VcSLENN2-Uit1wHBmx5qZS_-2EOg0WNAeSBg1lK4blObR3R88nH08j074W/pub?gid=122705340&single=true&output=csv';

  // ğŸ”¹ å…¨åŸŸè®Šæ•¸ï¼šå…¨éƒ¨è³‡æ–™ + ç•¶å‰å¹´æœˆ
  let allData = [];
  let currentYear = null;
  let currentMonth = null;

  // å·¥å…·ï¼šä»£è™Ÿå»æ‰å‰ç½® 0
  function normalizeCode(code) {
    return (code || '').toString().trim().replace(/^0+/, '');
  }

  // å·¥å…·ï¼šæ•¸å­—æ ¼å¼åŒ–
  function formatAmount(n, digits = 2) {
    if (n === null || n === undefined || isNaN(n)) return '-';
    return Number(n).toLocaleString('zh-TW', {
      minimumFractionDigits: digits,
      maximumFractionDigits: digits
    });
  }

  // ğŸ”¹ æ‰¾ã€Œä¸Šä¸€ç­†é…æ¯ç´€éŒ„ã€
  function findPreviousDividendRecord(etfCode, curYear, curMonth) {
    const target = normalizeCode(etfCode);
    let best = null;

    allData.forEach(r => {
      const code = normalizeCode(r['è‚¡è™Ÿ'] || r['è‚¡ç¥¨ä»£è™Ÿ']);
      if (!code || code !== target) return;

      const y = parseInt(r['è¥¿å…ƒ'], 10);
      const m = parseInt(r['æœˆä»½'], 10);
      if (isNaN(y) || isNaN(m)) return;

      // åªçœ‹æœ¬æœŸä¹‹å‰
      if (y < curYear || (y === curYear && m < curMonth)) {
        if (!best) {
          best = r;
        } else {
          const by = parseInt(best['è¥¿å…ƒ'], 10);
          const bm = parseInt(best['æœˆä»½'], 10);
          if (y > by || (y === by && m > bm)) {
            best = r;
          }
        }
      }
    });

    return best;
  }

  // å‰äº”åæ’è¡Œ
  function renderTop5(data) {
    const c = document.getElementById('top5-cards');
    c.innerHTML = '';
    const list = data
      .filter(r => r['é ä¼°é…æ¯'] && r['æ”¶ç›¤åƒ¹'])
      .map(r => {
        const est = parseFloat(r['é ä¼°é…æ¯']);
        const close = parseFloat(r['æ”¶ç›¤åƒ¹']);
        const rate = close ? (est / close) * 100 : NaN;
        return {
          code: r['è‚¡è™Ÿ'] || r['è‚¡ç¥¨ä»£è™Ÿ'],
          name: r['è‚¡ç¥¨åç¨±'],
          rate
        };
      })
      .filter(r => !isNaN(r.rate))
      .sort((a, b) => b.rate - a.rate)
      .slice(0, 5);
    const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
    list.forEach((r, i) => {
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded-2xl shadow-md border border-emerald-100 flex flex-col items-center justify-between';
      card.innerHTML = `
        <div class="text-3xl mb-1">${medals[i]}</div>
        <div class="text-center font-bold text-lg mb-1 text-[#1D4A35]">${r.code}</div>
        <div class="text-center text-xs text-gray-600 mb-2 leading-snug">${r.name}</div>
        <div class="text-center text-2xl font-semibold text-[#92400E]">${r.rate.toFixed(2)}%</div>
      `;
      c.appendChild(card);
    });
  }

  // ğŸ”¹ ç€‘å¸ƒç‰†å¡ç‰‡ï¼ˆå«ã€Œèˆ‡ä¸Šæ¬¡é…æ¯æ¯”è¼ƒã€ï¼‰
  function renderCards(data) {
    const c = document.getElementById('card-container');
    c.innerHTML = '';
    document.getElementById('loading').style.display = 'none';

    data.forEach(r => {
      const code = r['è‚¡è™Ÿ'];
      const name = r['è‚¡ç¥¨åç¨±'];
      const freq = r['é…æ¯é »ç‡'] || '';
      const close = r['æ”¶ç›¤åƒ¹'] || '-';
      const yieldRate = r['å–®æœŸæ®–åˆ©ç‡'] || '-';
      const exDate = r['é™¤æ¯æ—¥'] || '-';
      const payDate = r['ç™¼æ”¾æ—¥'] || '-';
      const estDivRaw = r['é ä¼°é…æ¯'];
      const actualDivRaw = r['å¯¦éš›é…æ¯'];
      const curDiv = parseFloat(actualDivRaw || estDivRaw || '0');

      // æ‰¾ä¸Šä¸€ç­†é…æ¯
      const prev = findPreviousDividendRecord(code, currentYear, currentMonth);
      let diffHtml = 'è¼ƒä¸Šæ¬¡é…æ¯ï¼šâ€”';

      if (prev) {
        const prevDiv = parseFloat(prev['å¯¦éš›é…æ¯'] || prev['é ä¼°é…æ¯'] || '0');
        if (curDiv > 0 && prevDiv > 0) {
          const diff = curDiv - prevDiv;
          const pct = (diff / prevDiv) * 100;
          let arrow = 'â–¬';
          let colorClass = 'text-gray-400';
          if (diff > 0) {
            arrow = 'â–²';
            colorClass = 'text-green-600';
          } else if (diff < 0) {
            arrow = 'â–¼';
            colorClass = 'text-red-500';
          }
          diffHtml = `è¼ƒä¸Šæ¬¡é…æ¯ï¼š<span class="${colorClass}">${arrow} ${diff > 0 ? '+' : ''}${diff.toFixed(3)} å…ƒï¼ˆ${diff > 0 ? '+' : ''}${pct.toFixed(1)}%ï¼‰</span>`;
        }
      }

      const card = document.createElement('div');
      card.className = 'bg-[#17453B] text-[#FFF8D6] p-5 rounded-2xl shadow-lg flex flex-col gap-3';
      card.innerHTML = `
        <div class="flex justify-between items-center">
          <div class="text-sm">
            <div class="text-xs uppercase tracking-[0.2em] text-emerald-100/90 mb-1">ETF</div>
            <div class="text-2xl font-extrabold text-amber-200">${code}</div>
          </div>
          <div class="text-xs bg-amber-400 text-[#1F2933] px-2 py-1 rounded-lg font-semibold shadow">
            ${freq || 'é…æ¯'}
          </div>
        </div>
        <div class="text-lg font-bold mb-2">${name}</div>
        <div class="grid grid-cols-2 gap-2 text-center">
          <div class="bg-amber-300 text-[#1F2933] p-3 rounded-xl shadow-inner">
            <div class="text-[0.7rem] mb-1">
              ${actualDivRaw ? 'å¯¦éš›é…æ¯' : 'é ä¼°é…æ¯'}
            </div>
            <div class="text-2xl font-extrabold">${actualDivRaw || estDivRaw || '-'}</div>
            <div class="text-[0.65rem] mt-1 text-[#374151]">æ¯è‚¡ï¼ˆå…ƒï¼‰</div>
          </div>
          <div class="bg-[#0f2c26] text-emerald-50 p-3 rounded-xl border border-emerald-300/70">
            <div class="text-[0.7rem] mb-1">æœ€å¾Œè²·é€²æ—¥</div>
            <div class="text-xl font-bold">${r['æœ€å¾Œè²·é€²æ—¥'] || '-'}</div>
            <div class="text-[0.65rem] mt-1 text-emerald-100/80">å«æ¯æœ€å¾Œä¸€å¤©</div>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-2 text-center text-sm">
          <div>
            <div class="text-[0.65rem] text-amber-100/80">æ”¶ç›¤åƒ¹</div>
            <div class="font-bold">${close}</div>
          </div>
          <div>
            <div class="text-[0.65rem] text-amber-100/80">å–®æœŸæ®–åˆ©ç‡</div>
            <div class="font-bold">${yieldRate}</div>
          </div>
          <div>
            <div class="text-[0.65rem] text-amber-100/80">é™¤æ¯æ—¥</div>
            <div class="font-bold">${exDate}</div>
          </div>
        </div>
        <div class="text-[0.7rem] text-right text-amber-100/90 mt-1">é…ç™¼æ—¥ï¼š${payDate}</div>
        <div class="text-[0.7rem] text-right text-amber-50 mt-1">${diffHtml}</div>
      `;
      c.appendChild(card);
    });
  }

  // æ”¶ç›Šçµ„æˆå¡ç‰‡
  function renderComposition(data) {
    const comp = document.getElementById('composition-container');
    comp.innerHTML = '';
    data.forEach(r => {
      const card = document.createElement('div');
      card.className = 'card-common';
      card.innerHTML = `
        <h3>${r['è‚¡è™Ÿ']}</h3>
        <div class="etf-name">${r['è‚¡ç¥¨åç¨±']}</div>
        <div class="bg-white/90 p-4 rounded-xl shadow-inner">
          <div class="grid grid-cols-3 gap-3 text-center text-[#17453B] text-xs md:text-sm">
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">å¹´åˆè‡³ä»Šå ±é…¬</div>
              <div class="text-sm md:text-base font-semibold">${r['å¹´åˆè‡³ä»Šå ±é…¬'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">å¯¦éš›é…æ¯</div>
              <div class="text-sm md:text-base font-semibold">${r['å¯¦éš›é…æ¯'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">è‚¡åˆ©æ‰€å¾—</div>
              <div class="text-sm md:text-base font-semibold">${r['è‚¡åˆ©æ‰€å¾—'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">54C</div>
              <div class="text-sm md:text-base font-semibold">${r['54C'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">åˆ©æ¯æ‰€å¾—</div>
              <div class="text-sm md:text-base font-semibold">${r['åˆ©æ¯æ‰€å¾—'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">æ”¶ç›Šå¹³æº–é‡‘</div>
              <div class="text-sm md:text-base font-semibold">${r['æ”¶ç›Šå¹³æº–é‡‘'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">è³‡æœ¬åˆ©å¾—</div>
              <div class="text-sm md:text-base font-semibold">${r['è³‡æœ¬åˆ©å¾—'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">å…¶ä»–æ‰€å¾—</div>
              <div class="text-sm md:text-base font-semibold">${r['å…¶ä»–æ‰€å¾—'] || '-'}</div>
            </div>
            <div class="highlight">
              <div class="text-[0.65rem] text-gray-500 mb-1">å¥ä¿æ‡‰èª²å¼µæ•¸</div>
              <div class="text-sm md:text-base font-semibold">${r['å¥ä¿æ‡‰èª²å¼µæ•¸'] || '-'}</div>
            </div>
          </div>
        </div>`;
      comp.appendChild(card);
    });
  }

  // é…æ¯æ™‚é–“è¡¨
  function renderTimeline(data) {
    const div = document.getElementById('dividendList');
    div.innerHTML = '';
    if (data.length === 0) {
      div.innerHTML = '<p class="text-center text-gray-500">âš ï¸ æœ¬æœˆç„¡é…æ¯å…¥å¸³è³‡æ–™</p>';
      return;
    }
    const groups = {};
    data.forEach(r => {
      const date = (r['ç™¼æ”¾æ—¥'] || '').trim();
      if (!date) return;
      groups[date] = groups[date] || [];
      groups[date].push(r);
    });
    Object.keys(groups).sort((a, b) => new Date(a) - new Date(b))
      .forEach(date => {
        const card = document.createElement('div');
        card.className = 'etf-timeline-card mb-6';
        card.innerHTML = `
          <div class="text-lg font-bold text-[#1D4A35] mb-3 flex items-center gap-2">
            <span class="bg-[#1D4A35] text-white text-xs px-2 py-1 rounded">ç™¼æ”¾æ—¥</span>${date}
          </div>
          <div class="divide-y divide-yellow-200">
            ${groups[date].map(etf => `
              <div class="grid grid-cols-[90px_1fr_120px] items-start py-2 text-sm">
                <div class="font-bold text-[#1D4A35]">${etf['è‚¡è™Ÿ']}</div>
                <div class="text-gray-800 break-words">${etf['è‚¡ç¥¨åç¨±']}</div>
                <div class="text-right text-gray-700">
                  æ¯è‚¡é…æ¯ ${(etf['å¯¦éš›é…æ¯'] || etf['é ä¼°é…æ¯'] || '-')} å…ƒ
                </div>
              </div>`).join('')}
          </div>`;
        div.appendChild(card);
      });
  }

  // ğŸ”¹ ä½ çš„ETFé…æ¯è©¦ç®—
  function handleMyDividendCalc() {
    const codeInput = document.getElementById('my-dividend-code').value;
    const lotsInput = document.getElementById('my-dividend-lots').val
