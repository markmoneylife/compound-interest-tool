<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ETFé…æ¯åœ–å¡ç€‘å¸ƒç‰†ï¼‹é…æ¯å…¥å¸³æ™‚é–“è¡¨ï½œå³é¦¬å…‹</title>

  <link rel="icon" href="https://markmoney738404280.wordpress.com/wp-content/uploads/2025/06/e8a487e588a9e8a9a6e7ae97e5b7a5e585b7.png" type="image/png">

  <meta property="og:title" content="ETFé…æ¯åœ–å¡ç€‘å¸ƒç‰†ï½œæ®–åˆ©ç‡ Ã— å…¥å¸³æ™‚é–“ä¸€çœ¼æŒæ¡ï½œé¦¬å…‹ç†è²¡" />
  <meta property="og:description" content="æ¯æœˆæ›´æ–°çš„ETFé…æ¯åœ–å¡è¦–è¦ºç€‘å¸ƒç‰†ï¼ŒåŒ…å«æ®–åˆ©ç‡ã€ç™¼æ”¾æ—¥èˆ‡æ”¶ç›Šçµ„æˆï¼Œè®“ä½ è¼•é¬†è¿½è¹¤é«˜è‚¡æ¯è³‡è¨Šã€‚" />
  <meta property="og:image" content="https://markmoney738404280.wordpress.com/wp-content/uploads/2025/06/e8a487e588a9e8a9a6e7ae97e5b7a5e585b7.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://markmoneylife.com/etf-dividend-wall/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="é¦¬å…‹ç†è²¡å·¥å…·ç®±" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ETFé…æ¯åœ–å¡ç€‘å¸ƒç‰†ï½œæ®–åˆ©ç‡ Ã— å…¥å¸³æ™‚é–“ä¸€çœ¼æŒæ¡ï½œé¦¬å…‹ç†è²¡">
  <meta name="twitter:description" content="æ¯æœˆæ›´æ–°çš„ETFé…æ¯åœ–å¡ç€‘å¸ƒç‰†ï¼ŒåŒ…å«æ®–åˆ©ç‡ã€ç™¼æ”¾æ—¥èˆ‡æ”¶ç›Šçµ„æˆï¼Œè®“ä½ è¼•é¬†è¿½è¹¤é«˜è‚¡æ¯è³‡è¨Šã€‚">
  <meta name="twitter:image" content="https://markmoney738404280.wordpress.com/wp-content/uploads/2025/06/e8a487e588a9e8a9a6e7ae97e5b7a5e585b7.png">

  <meta name="description" content="è¦–è¦ºåŒ–é¡¯ç¤ºå°è‚¡ETFæœ€æ–°é…æ¯è³‡è¨Šèˆ‡å¯¦éš›å…¥å¸³æ™‚é–“ï¼Œè®“ä½ å¿«é€ŸæŒæ¡æ®–åˆ©ç‡èˆ‡ç™¼æ”¾æ—¥ã€‚">
  <meta name="keywords" content="ETFé…æ¯, é«˜è‚¡æ¯ETF, å°è‚¡ETF, å–®æœŸæ®–åˆ©ç‡, ç™¼æ”¾æ—¥, å³é¦¬å…‹">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ========= Mark-UIï¼ˆé »é“ç¶²ç«™ï¼‰é¢¨æ ¼ï¼šæ·±ç¶ ï¼‹æ·±è—ï¼‹å°‘é‡æš–é»ƒ ========= */
    :root{
      --bg: #020911;
      --bg2:#071623;
      --panel:#06252c;
      --panel2:#052b34;
      --border: rgba(148,163,184,.22);
      --text:#E8EEF6;
      --muted: rgba(232,238,246,.72);

      --g1:#0B3B2E;    /* æ·±ç¶  */
      --g2:#1D4A35;    /* ç¶  */
      --b1:#0A2A4A;    /* æ·±è— */
      --b2:#0B3A6A;    /* è— */

      --accent:#FFD54F;        /* æš–é»ƒ */
      --accent2:#FFE082;

      --shadow: 0 18px 40px rgba(0,0,0,.45);
      --shadow2: 0 10px 22px rgba(0,0,0,.35);
      --r: 18px;
    }

    html,body{ height:100%; }
    body{
      background:
        radial-gradient(1200px 900px at 20% -10%, rgba(29,74,53,.45), transparent 55%),
        radial-gradient(1000px 900px at 95% 5%, rgba(10,58,106,.40), transparent 55%),
        radial-gradient(900px 700px at 40% 110%, rgba(255,213,79,.10), transparent 55%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      color: var(--text);
    }

    /* å°æ˜Ÿé»ï¼ˆå¾ˆæ·¡ï¼Œä¸æ¶ï¼‰ */
    .starfield{
      position: fixed;
      inset: 0;
      pointer-events:none;
      opacity:.35;
      background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.35) 50%, transparent 52%),
        radial-gradient(1px 1px at 80% 25%, rgba(255,255,255,.25) 50%, transparent 52%),
        radial-gradient(1px 1px at 55% 60%, rgba(255,255,255,.22) 50%, transparent 52%),
        radial-gradient(1px 1px at 30% 75%, rgba(255,255,255,.18) 50%, transparent 52%),
        radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,.16) 50%, transparent 52%);
      background-size: 420px 420px, 520px 520px, 620px 620px, 720px 720px, 820px 820px;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }

    /* ========= é ‚éƒ¨å›ºå®šå°è¦½ ========= */
    .nav-toggle{
      display:none;
      position: fixed;
      top: .85rem;
      right: .85rem;
      z-index: 9999;
      background: linear-gradient(135deg, rgba(255,213,79,.95), rgba(255,224,130,.95));
      border: 1px solid rgba(0,0,0,.15);
      padding: .6rem .95rem;
      border-radius: .75rem;
      font-size: 1.05rem;
      font-weight: 800;
      cursor: pointer;
      box-shadow: var(--shadow2);
      color: #0B1220;
    }

    .nav-bar-wrapper{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(2,9,17,.82), rgba(2,9,17,.55));
      border-bottom: 1px solid rgba(148,163,184,.18);
    }

    .nav-shell{
      max-width: 1180px;
      margin: 0 auto;
      padding: 1rem 1rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 1rem;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:.75rem;
      min-width: 220px;
      text-decoration:none;
    }

    .brand-badge{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background:
        radial-gradient(18px 18px at 30% 35%, rgba(255,213,79,.35), transparent 55%),
        linear-gradient(135deg, rgba(29,74,53,.95), rgba(10,58,106,.95));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      color: rgba(255,255,255,.9);
      font-weight: 900;
      letter-spacing: .02em;
    }

    .brand-title{
      line-height:1.1;
    }
    .brand-title strong{
      display:block;
      font-size: .95rem;
      font-weight: 900;
      color: rgba(255,255,255,.92);
    }
    .brand-title span{
      display:block;
      font-size: .72rem;
      color: rgba(232,238,246,.62);
    }

    .nav-bar{
      display:flex;
      flex-wrap: wrap;
      justify-content:flex-end;
      gap: .6rem;
    }

    .nav-bar a{
      text-decoration:none;
      padding: .62rem .95rem;
      border-radius: 999px;
      font-weight: 800;
      font-size: .9rem;
      color: rgba(232,238,246,.88);
      background: linear-gradient(135deg, rgba(6,37,44,.85), rgba(5,43,52,.85));
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
      transition: transform .18s, box-shadow .18s, border-color .18s, background .18s;
    }
    .nav-bar a:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 26px rgba(0,0,0,.35);
      border-color: rgba(255,213,79,.35);
      background: linear-gradient(135deg, rgba(6,37,44,.95), rgba(5,43,52,.95));
    }

    .nav-bar a.cta{
      color: #0B1220;
      background: linear-gradient(135deg, rgba(255,213,79,.98), rgba(255,224,130,.98));
      border: 1px solid rgba(0,0,0,.12);
    }
    .nav-bar a.cta:hover{
      border-color: rgba(255,255,255,.12);
      box-shadow: 0 16px 30px rgba(255,213,79,.16), 0 14px 26px rgba(0,0,0,.35);
    }

    @media (max-width: 900px){
      .brand{ min-width: auto; }
      .nav-bar{ display:none; flex-direction: column; align-items: stretch; width: 100%; }
      .nav-bar.active{ display:flex; }
      .nav-shell{ flex-direction: column; align-items: stretch; }
      .nav-toggle{ display:block; }
      .nav-bar a{ width: 100%; text-align:center; border-radius: 14px; }
    }

    /* ========= ç‰ˆé¢å®¹å™¨ ========= */
    .page-shell{
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1rem 0;
    }

    .hero{
      margin-top: 1.25rem;
      border-radius: calc(var(--r) + 8px);
      padding: 1.4rem 1.2rem;
      background:
        radial-gradient(900px 420px at 15% 0%, rgba(29,74,53,.45), transparent 60%),
        radial-gradient(900px 420px at 95% 10%, rgba(10,58,106,.40), transparent 60%),
        linear-gradient(135deg, rgba(6,37,44,.82), rgba(5,43,52,.78));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: var(--shadow);
    }

    .hero h1{
      font-size: 1.75rem;
      font-weight: 950;
      letter-spacing: .01em;
      color: rgba(255,255,255,.92);
      text-align:center;
      margin-bottom: .35rem;
    }
    .hero p{
      text-align:center;
      color: rgba(232,238,246,.70);
      font-size: .92rem;
      line-height: 1.7;
      margin-bottom: .75rem;
    }

    .meta-row{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
      align-items:center;
      justify-content:center;
      color: rgba(232,238,246,.65);
      font-size: .78rem;
    }
    .meta-pill{
      display:inline-flex;
      gap:.4rem;
      align-items:center;
      padding:.42rem .7rem;
      border-radius: 999px;
      background: rgba(2,9,17,.35);
      border: 1px solid rgba(148,163,184,.18);
    }
    .meta-row a{
      color: rgba(255,213,79,.92);
      text-decoration: none;
      font-weight: 800;
    }
    .meta-row a:hover{ text-decoration: underline; }

    /* ========= å€å¡Šå¡ç‰‡ ========= */
    .section-card{
      margin-top: 1.2rem;
      border-radius: calc(var(--r) + 6px);
      background: linear-gradient(135deg, rgba(6,37,44,.78), rgba(5,43,52,.74));
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: var(--shadow2);
      padding: 1.15rem 1.1rem;
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: .8rem;
      margin-bottom: .75rem;
    }
    .section-title h2{
      font-size: 1.08rem;
      font-weight: 950;
      color: rgba(255,255,255,.90);
      letter-spacing: .01em;
    }
    .section-title .hint{
      font-size: .78rem;
      color: rgba(232,238,246,.62);
    }

    /* ========= æ¨¡å¼åˆ‡æ› ========= */
    .mode-switch{
      display:flex;
      gap:.6rem;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 1rem;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding:.72rem 1rem;
      border-radius: 999px;
      font-weight: 900;
      font-size: .92rem;
      transition: transform .18s, box-shadow .18s, opacity .18s, border-color .18s, background .18s;
      box-shadow: 0 12px 24px rgba(0,0,0,.28);
    }
    .btn:active{ transform: translateY(1px); }

    .btn-primary{
      color: #0B1220;
      background: linear-gradient(135deg, rgba(255,213,79,.98), rgba(255,224,130,.98));
      border: 1px solid rgba(0,0,0,.12);
    }
    .btn-ghost{
      color: rgba(232,238,246,.88);
      background: linear-gradient(135deg, rgba(2,9,17,.35), rgba(2,9,17,.22));
      border: 1px solid rgba(148,163,184,.18);
    }
    .btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 16px 30px rgba(0,0,0,.38);
    }

    /* ========= å°å·¥å…·åˆ—ï¼ˆé¡¯ç¤ºæœˆä»½ / æœå°‹ / æ’åº / è»¸åˆ‡æ›ï¼‰ ========= */
    .toolbar{
      margin-top: 1rem;
      display:flex;
      flex-wrap:wrap;
      gap: .7rem;
      align-items:center;
      justify-content:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding:.45rem .75rem;
      border-radius:999px;
      background: rgba(2,9,17,.35);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      font-size:.8rem;
      color: rgba(232,238,246,.72);
      white-space:nowrap;
    }
    .chip strong{ color: rgba(255,255,255,.90); font-weight: 950; }
    .chip .hl{ color: rgba(255,213,79,.95); font-weight: 950; }

    .select, .search{
      border-radius:999px;
      background: rgba(2,9,17,.35);
      border: 1px solid rgba(148,163,184,.18);
      color: rgba(255,255,255,.90);
      padding: .55rem .8rem;
      outline:none;
      min-height: 40px;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
    }
    .select{ padding-right: 2.2rem; }
    .search{ width: min(420px, 92vw); }
    .select:focus, .search:focus{
      border-color: rgba(255,213,79,.38);
      box-shadow: 0 0 0 3px rgba(255,213,79,.12);
    }

    .axis-btn{
      border:none;
      cursor:pointer;
      padding:.6rem .95rem;
      border-radius:999px;
      font-weight: 950;
      font-size: .86rem;
      color: #0B1220;
      background: linear-gradient(135deg, rgba(255,213,79,.92), rgba(255,224,130,.92));
      border: 1px solid rgba(0,0,0,.12);
      box-shadow: 0 12px 24px rgba(0,0,0,.28);
      transition: transform .18s, box-shadow .18s;
    }
    .axis-btn:hover{ transform: translateY(-2px); box-shadow: 0 16px 30px rgba(0,0,0,.38); }

    /* ========= æ‘˜è¦å¡ ========= */
    .summary-grid{
      margin-top: 1rem;
      display:grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap:.85rem;
    }
    @media (min-width: 640px){
      .summary-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    .summary-card{
      border-radius: calc(var(--r) + 6px);
      padding: .95rem .95rem;
      background:
        radial-gradient(220px 160px at 20% 0%, rgba(255,213,79,.14), transparent 60%),
        linear-gradient(135deg, rgba(6,37,44,.82), rgba(5,43,52,.78));
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 14px 26px rgba(0,0,0,.32);
      text-align:center;
    }
    .summary-card .k{
      font-size:.78rem;
      color: rgba(232,238,246,.64);
      font-weight: 850;
      letter-spacing:.02em;
    }
    .summary-card .v{
      margin-top:.25rem;
      font-size: 1.35rem;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
    }
    .summary-card .v.hl{ color: rgba(255,213,79,.98); }

    /* ========= Top5 å¡ç‰‡ ========= */
    .top5-grid{
      display:grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: .85rem;
    }
    @media (min-width: 640px){
      .top5-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px){
      .top5-grid{ grid-template-columns: repeat(5, minmax(0, 1fr)); }
    }

    .top5-card{
      border-radius: var(--r);
      padding: 1rem .95rem;
      background:
        radial-gradient(120px 120px at 25% 20%, rgba(255,213,79,.18), transparent 60%),
        linear-gradient(135deg, rgba(6,37,44,.82), rgba(5,43,52,.78));
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 14px 26px rgba(0,0,0,.34);
      transition: transform .18s, box-shadow .18s, border-color .18s;
      text-align:center;
    }
    .top5-card:hover{
      transform: translateY(-3px);
      border-color: rgba(255,213,79,.34);
      box-shadow: 0 18px 34px rgba(0,0,0,.42);
    }
    .top5-card .code{ font-weight: 950; font-size: 1.15rem; color: rgba(255,255,255,.92); }
    .top5-card .name{ font-size: .78rem; color: rgba(232,238,246,.68); margin-top:.25rem; min-height: 2.2em; }
    .top5-card .rate{ font-weight: 950; font-size: 1.35rem; color: rgba(255,213,79,.98); margin-top:.35rem; }

    /* ========= ç€‘å¸ƒç‰†å¡ç‰‡ ========= */
    .grid-cards{
      display:grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 1rem;
    }
    @media (min-width: 640px){
      .grid-cards{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px){
      .grid-cards{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .etf-card{
      border-radius: calc(var(--r) + 8px);
      padding: 1.05rem 1.05rem 1rem;
      background:
        radial-gradient(240px 200px at 12% 10%, rgba(29,74,53,.48), transparent 60%),
        radial-gradient(240px 200px at 92% 20%, rgba(10,58,106,.40), transparent 62%),
        linear-gradient(135deg, rgba(6,37,44,.86), rgba(5,43,52,.82));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 16px 34px rgba(0,0,0,.44);
      transition: transform .18s, box-shadow .18s, border-color .18s;
    }
    .etf-card:hover{
      transform: translateY(-4px);
      border-color: rgba(255,213,79,.28);
      box-shadow: 0 20px 44px rgba(0,0,0,.52);
    }

    .etf-card .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: .6rem;
    }
    .badge-freq{
      font-size: .72rem;
      font-weight: 950;
      padding: .35rem .6rem;
      border-radius: 999px;
      color: rgba(255,255,255,.92);
      background: rgba(255,213,79,.12);
      border: 1px solid rgba(255,213,79,.22);
      white-space: nowrap;
    }
    .code-big{
      font-size: 1.75rem;
      font-weight: 1000;
      color: rgba(255,213,79,.98);
      letter-spacing: .02em;
    }
    .etf-name{
      margin-top: .15rem;
      font-size: 1.06rem;
      font-weight: 950;
      color: rgba(255,255,255,.90);
    }

    .two-box{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: .75rem;
      margin-top: .9rem;
    }
    .info-box{
      border-radius: var(--r);
      padding: .85rem .75rem;
      background: rgba(2,9,17,.35);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      text-align:center;
    }
    .info-box .label{
      font-size: .72rem;
      color: rgba(232,238,246,.62);
      margin-bottom: .2rem;
      font-weight: 800;
    }
    .info-box .value{
      font-size: 1.25rem;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
    }
    .info-box.accent{
      background: rgba(255,213,79,.12);
      border-color: rgba(255,213,79,.22);
    }
    .info-box.accent .value{ color: rgba(255,213,79,.98); }

    .mini-grid{
      margin-top: .85rem;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: .6rem;
      text-align:center;
    }
    .mini{
      padding: .6rem .5rem;
      border-radius: var(--r);
      background: rgba(2,9,17,.25);
      border: 1px solid rgba(148,163,184,.16);
    }
    .mini .k{ font-size: .7rem; color: rgba(232,238,246,.60); font-weight: 800; }
    .mini .v{ margin-top: .15rem; font-size: .9rem; font-weight: 950; color: rgba(255,255,255,.88); }

    .footrow{
      margin-top: .8rem;
      display:flex;
      flex-direction:column;
      gap:.25rem;
      align-items:flex-end;
      font-size: .74rem;
      color: rgba(232,238,246,.58);
    }

    /* ========= ä½ çš„ETFé…å¤šå°‘ï¼ˆå·¥å…·å¡ï¼‰ ========= */
    .tool-card{
      border-radius: calc(var(--r) + 8px);
      padding: 1.05rem 1.05rem 1rem;
      background:
        radial-gradient(240px 200px at 20% 0%, rgba(255,213,79,.12), transparent 60%),
        linear-gradient(135deg, rgba(6,37,44,.86), rgba(5,43,52,.82));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
    }
    .tool-card h3{
      font-size: 1.05rem;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
    }
    .tool-card p{
      color: rgba(232,238,246,.66);
      font-size: .86rem;
      line-height: 1.7;
    }
    .field-label{
      font-size: .75rem;
      color: rgba(232,238,246,.62);
      font-weight: 800;
      margin-bottom: .25rem;
    }
    .field{
      width:100%;
      border-radius: 14px;
      background: rgba(2,9,17,.35);
      border: 1px solid rgba(148,163,184,.18);
      color: rgba(255,255,255,.90);
      padding: .7rem .85rem;
      outline: none;
      transition: border-color .18s, box-shadow .18s;
    }
    .field:focus{
      border-color: rgba(255,213,79,.38);
      box-shadow: 0 0 0 3px rgba(255,213,79,.12);
    }
    .tool-result{
      margin-top: .85rem;
      padding: .9rem .95rem;
      border-radius: var(--r);
      background: rgba(2,9,17,.25);
      border: 1px solid rgba(148,163,184,.16);
      color: rgba(232,238,246,.82);
      line-height: 1.75;
      font-size: .9rem;
    }
    .tool-result strong{ color: rgba(255,255,255,.92); }
    .tool-result .money{
      color: rgba(255,213,79,.98);
      font-weight: 1000;
      font-size: 1.05rem;
    }

    /* ========= æ”¶ç›Šçµ„æˆå¡ç‰‡ ========= */
    .card-common{
      border-radius: calc(var(--r) + 8px);
      background:
        radial-gradient(260px 220px at 15% 10%, rgba(29,74,53,.42), transparent 62%),
        radial-gradient(260px 220px at 92% 20%, rgba(10,58,106,.36), transparent 62%),
        linear-gradient(135deg, rgba(6,37,44,.86), rgba(5,43,52,.82));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
      padding: 1.05rem 1.05rem 1rem;
      color: rgba(232,238,246,.92);
      transition: transform .18s, box-shadow .18s, border-color .18s;
      position: relative;
    }
    .card-common:hover{
      transform: translateY(-4px);
      border-color: rgba(255,213,79,.22);
      box-shadow: 0 22px 50px rgba(0,0,0,.55);
    }
    .card-common h3{
      font-size: 1.05rem;
      font-weight: 1000;
      color: rgba(255,213,79,.98);
      margin-bottom: .15rem;
    }
    .card-common .etf-name{
      font-size: .82rem;
      color: rgba(232,238,246,.62);
      margin-bottom: .75rem;
      font-weight: 800;
    }
    .highlight{
      background: rgba(2,9,17,.30);
      border: 1px solid rgba(148,163,184,.14);
      padding: .7rem .6rem;
      border-radius: 16px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .highlight .t{ font-size:.7rem; color: rgba(232,238,246,.62); font-weight: 800; }
    .highlight .v{ margin-top:.1rem; font-size: .95rem; font-weight: 1000; color: rgba(255,255,255,.90); }

    /* ========= äºŒä»£å¥ä¿å€ ========= */
    .info-panel{
      border-radius: calc(var(--r) + 6px);
      background: rgba(2,9,17,.28);
      border: 1px solid rgba(148,163,184,.16);
      padding: 1rem;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      color: rgba(232,238,246,.78);
    }
    .info-panel h4{
      font-size: 1rem;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
      margin-bottom: .45rem;
    }
    .info-panel li{
      margin: .25rem 0;
      line-height: 1.7;
      font-size: .86rem;
    }

    /* ========= é…æ¯æ™‚é–“è¡¨ ========= */
    .timeline-card{
      border-radius: calc(var(--r) + 8px);
      background:
        radial-gradient(260px 220px at 18% 5%, rgba(255,213,79,.12), transparent 65%),
        linear-gradient(135deg, rgba(6,37,44,.86), rgba(5,43,52,.82));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .timeline-head{
      display:flex;
      align-items:center;
      gap:.5rem;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
      margin-bottom: .75rem;
    }
    .tag-date{
      font-size: .72rem;
      padding: .3rem .55rem;
      border-radius: 999px;
      background: rgba(255,213,79,.12);
      border: 1px solid rgba(255,213,79,.22);
      color: rgba(255,213,79,.98);
    }
    .timeline-row{
      display:grid;
      grid-template-columns: 90px 1fr 140px;
      gap: .6rem;
      padding: .6rem 0;
      border-top: 1px solid rgba(148,163,184,.14);
      color: rgba(232,238,246,.82);
      font-size: .88rem;
      align-items:start;
    }
    .timeline-row:first-child{ border-top: none; padding-top: 0; }
    .timeline-code{ font-weight: 1000; color: rgba(255,213,79,.98); }
    .timeline-name{ color: rgba(232,238,246,.80); word-break: break-word; }
    .timeline-val{ text-align:right; color: rgba(255,255,255,.86); font-weight: 900; }

    @media (max-width: 520px){
      .timeline-row{ grid-template-columns: 80px 1fr; }
      .timeline-val{ grid-column: 1 / -1; text-align:left; opacity:.9; }
    }

    /* ========= Footer ========= */
    footer{
      margin-top: 2.5rem;
      padding: 2rem 1rem 2.5rem;
      background: linear-gradient(180deg, rgba(2,9,17,.35), rgba(2,9,17,.20));
      border-top: 1px solid rgba(148,163,184,.16);
      color: rgba(232,238,246,.62);
      font-size: .8rem;
    }
    .footer-shell{
      max-width: 1100px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }
    @media (min-width: 768px){
      .footer-shell{ grid-template-columns: 1fr 1fr; }
    }
    .footer-shell a{ color: rgba(255,213,79,.92); text-decoration:none; font-weight: 900; }
    .footer-shell a:hover{ text-decoration: underline; }
    .risk li{ margin:.25rem 0; line-height: 1.7; }

    /* è®“ Tailwind çš„ text-gray-XXX ä¸æŠŠæ·±è‰²UIå¼„ç°åˆ°åº• */
    .tw-muted{ color: rgba(232,238,246,.62) !important; }

    /* å°æç¤ºåˆ—ï¼ˆæˆåŠŸ/å¤±æ•—/å¿«å–ï¼‰ */
    .statusline{
      margin-top:.9rem;
      text-align:center;
      font-size:.82rem;
      color: rgba(232,238,246,.66);
    }
    .statusline .ok{ color: rgba(52,211,153,.95); font-weight: 950; }
    .statusline .warn{ color: rgba(255,213,79,.95); font-weight: 950; }
    .statusline .bad{ color: rgba(248,113,113,.95); font-weight: 950; }
  </style>
</head>

<body>
  <div class="starfield"></div>

  <button class="nav-toggle" onclick="toggleNav()">â˜° é¸å–®</button>

  <div class="nav-bar-wrapper">
    <div class="nav-shell">
      <a class="brand" href="https://markmoneylife.com/" aria-label="å›åˆ°é¦¬å…‹ç†è²¡å·¥å…·ç®±é¦–é ">
        <div class="brand-badge">M</div>
        <div class="brand-title">
          <strong>é¦¬å…‹ç†è²¡å·¥å…·ç®±</strong>
          <span>æ·±ç¶  Ã— æ·±è—ï½œæŠŠé…æ¯è®Šæˆä½ çš„å„€è¡¨æ¿</span>
        </div>
      </a>

      <div id="navBar" class="nav-bar">
        <a href="#wall">ç€‘å¸ƒç‰†</a>
        <a href="#my-dividend">é€™æœŸé…å¤šå°‘ï¼Ÿ</a>
        <a href="#timeline">å…¥å¸³æ™‚é–“è¡¨</a>
        <a href="https://markmoneylife.com/etf-compound/">è¤‡åˆ©è©¦ç®—</a>
        <a href="https://markmoneylife.com/retire-reverse/">é€€ä¼‘å€’æ¨</a>
        <a href="https://markmoneylife.com/newbie-village/">æ–°æ‰‹æŠ•è³‡æ‘</a>
        <a href="https://markmoneylife.com/etf-tracker/">ETFè¿½è¹¤ç‰†</a>
        <a class="cta" href="https://forms.gle/DKRoQizqLVBCe7Dj6" target="_blank" rel="noopener">åŠ å…¥LINEç¤¾ç¾¤</a>
      </div>
    </div>
  </div>

  <main class="page-shell">
    <section id="wall" class="hero">
      <h1>ETF é…æ¯åœ–å¡ç€‘å¸ƒç‰†</h1>
      <p>æ®–åˆ©ç‡ã€é™¤æ¯/é…ç™¼æ—¥ã€æ”¶ç›Šçµ„æˆä¸€æ¬¡çœ‹æ‡‚ã€‚é…æ¯æ˜¯ç¾é‡‘æµï¼Œä¸æ˜¯ä¿è­‰ç²åˆ©â€”â€”ä½†è‡³å°‘å…ˆæŠŠæ•¸å­—çœ‹æ¸…æ¥šã€‚</p>

      <div class="meta-row">
        <span class="meta-pill">
          ğŸ“Š è³‡æ–™ä¾†æºï¼š
          <a href="https://www.twse.com.tw/zh/ETFortune/announcementList" target="_blank" rel="noopener">è‡ºç£è­‰åˆ¸äº¤æ˜“æ‰€</a>
        </span>
        <span class="meta-pill" id="last-update">æ›´æ–°æ™‚é–“ï¼šâ€”</span>
      </div>

      <div class="toolbar" aria-label="ç¯©é¸å·¥å…·åˆ—">
        <span class="chip">ğŸ“… <strong>é¡¯ç¤ºæœˆä»½</strong></span>
        <select id="monthSelect" class="select" aria-label="é¡¯ç¤ºæœˆä»½"></select>

        <button id="axisBtn" class="axis-btn" type="button" aria-label="åˆ‡æ›çœ‹å…¬å‘Šæˆ–çœ‹å…¥å¸³">çœ‹å…¬å‘Šï¼ˆé»åˆ‡æ›ï¼‰</button>

        <input id="searchInput" class="search" type="search" placeholder="ğŸ” æœå°‹ ETFï¼ˆä»£è™Ÿ / åç¨±ï¼‰ä¾‹å¦‚ï¼š00919ã€å…ƒå¤§é«˜è‚¡æ¯" aria-label="æœå°‹ ETF" />

        <select id="sortSelect" class="select" aria-label="æ’åºæ–¹å¼">
          <option value="yield_desc">æ’åºï¼šæ®–åˆ©ç‡é«˜â†’ä½</option>
          <option value="pay_asc">æ’åºï¼šç™¼æ”¾æ—¥è¿‘â†’é </option>
          <option value="div_desc">æ’åºï¼šé…æ¯é«˜â†’ä½</option>
        </select>
      </div>

      <div class="statusline" id="statusLine">è¼‰å…¥ä¸­â€¦</div>

      <div class="summary-grid" id="summaryGrid" style="display:none;">
        <div class="summary-card">
          <div class="k">æœ¬æœˆæœ‰é…æ¯çš„ ETF</div>
          <div class="v hl" id="sumCount">â€”</div>
        </div>
        <div class="summary-card">
          <div class="k">å–®æœŸæ®–åˆ©ç‡ï¼ˆä¸­ä½æ•¸ï¼‰</div>
          <div class="v" id="sumMedian">â€”</div>
        </div>
        <div class="summary-card">
          <div class="k">æœ€é«˜å–®æœŸæ®–åˆ©ç‡</div>
          <div class="v hl" id="sumTop">â€”</div>
        </div>
      </div>

      <div class="mode-switch" id="mode-switch">
        <button data-mode="forecast" class="btn btn-primary">é ä¼°é…æ¯æ¨¡å¼</button>
        <button data-mode="distribution" class="btn btn-ghost">æ”¶ç›Šçµ„æˆæ¨¡å¼</button>
      </div>
    </section>

    <section id="my-dividend" class="section-card">
      <div class="section-title">
        <h2>ğŸ§® ä½ çš„ ETF é€™æœŸé…å¤šå°‘ï¼Ÿ</h2>
        <div class="hint">ç”¨ã€Œé¡¯ç¤ºæœˆä»½ã€è³‡æ–™ä¼°ç®—ï¼ˆæ¯è‚¡é…æ¯ Ã— 1000 è‚¡ Ã— å¼µæ•¸ï¼‰</div>
      </div>

      <p style="color: rgba(232,238,246,.66); font-size:.88rem; line-height:1.7; margin-bottom:.9rem;">
        è¼¸å…¥ ETF ä»£è™Ÿï¼‹æŒæœ‰å¼µæ•¸ï¼Œå¹«ä½ ä¼°ç®—æœ¬æœŸå¤§æ¦‚å¯ä»¥é ˜å¤šå°‘é…æ¯ã€‚è‹¥æœ¬æœŸå°šæœªå…¬å‘Šã€Œå¯¦éš›é…æ¯ã€ï¼Œå°±ç”¨ã€Œé ä¼°é…æ¯ã€å…ˆæŠ“å€‹ç¯„åœã€‚
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div>
          <div class="field-label">ETF ä»£è™Ÿï¼ˆä¾‹å¦‚ï¼š00919ã€00713ï¼‰</div>
          <input id="my-dividend-code" class="field" type="text" placeholder="è«‹è¼¸å…¥ETFä»£è™Ÿ" />
        </div>
        <div>
          <div class="field-label">æŒæœ‰è‚¡æ•¸ï¼ˆå«é›¶è‚¡ï¼‰</div>
          <input id="my-dividend-lots" class="field" type="number" min="1" step="1" value="1" />
        </div>
        <div>
          <button id="my-dividend-btn" class="btn btn-primary w-full">å¹«æˆ‘ç®—é€™æ¬¡å¯ä»¥é ˜å¤šå°‘</button>
        </div>
      </div>

      <div id="my-dividend-result" class="tool-result">è¼¸å…¥å¾ŒæŒ‰ä¸‹æŒ‰éˆ•ï¼Œæˆ‘æœƒæŠŠä¼°ç®—çµæœæ”¾åœ¨é€™è£¡ã€‚</div>
    </section>

    <section id="mode-forecast" class="section-card">
      <div class="section-title">
        <h2>ğŸ¥‡ å‰äº”åå–®æœŸæ®–åˆ©ç‡</h2>
        <div class="hint">ä»¥ã€Œé ä¼°é…æ¯ Ã· æ”¶ç›¤åƒ¹ã€è¨ˆç®—ï¼ˆåƒ…ä¾›åƒè€ƒï¼‰</div>
      </div>
      <div id="top5-cards" class="top5-grid"></div>

      <div id="loading" class="text-center" style="color: rgba(232,238,246,.62); font-size:.9rem; margin: .9rem 0 0;">è¼‰å…¥ä¸­...</div>
      <div id="card-container" class="grid-cards" style="margin-top: 1rem;"></div>
    </section>

    <section id="mode-distribution" class="section-card" style="display:none;">
      <div class="section-title">
        <h2>ğŸ“Š æœ¬æœˆé…æ¯æ”¶ç›Šçµ„æˆ</h2>
        <div class="hint">è‚¡åˆ©/åˆ©æ¯/å¹³æº–é‡‘/è³‡æœ¬åˆ©å¾—/å…¶ä»–æ‰€å¾—</div>
      </div>

      <div class="info-panel">
        <h4>äºŒä»£å¥ä¿è£œå……ä¿è²»ç°¡ä»‹ï¼ˆè¶…ç²¾ç°¡ï¼‰</h4>
        <ul class="list-disc pl-5">
          <li>è²»ç‡å›ºå®š 2.11ï¼…</li>
          <li>é‡å°ã€Œå–®ä½è–ªè³‡å·®é¡ã€æˆ–ã€Œå–®æ¬¡æ‰€å¾—ã€åŠ å¾µ</li>
          <li>å–®æ¬¡çµ¦ä»˜ â‰¥ 20,000 å…ƒï¼ˆå¹´çµ‚ã€åˆ©æ¯ã€è‚¡åˆ©ç­‰ï¼‰å¯èƒ½éœ€æ‰£</li>
          <li>è‹¥æ‰€å¾—æœªé”åŸºæœ¬å·¥è³‡æˆ–å±¬å…­é¡å¼±å‹¢ï¼Œå¯ä¾è¦å®šç”³è«‹å…æ‰£</li>
        </ul>
      </div>

      <div id="composition-container" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3" style="margin-top: 1rem;"></div>
    </section>

    <section id="timeline" class="section-card" style="margin-top: 1.2rem;">
      <div class="section-title">
        <h2 id="timeline-header">ğŸ“… æœ¬æœˆ ETF é…æ¯å…¥å¸³æ™‚é–“è¡¨</h2>
        <div class="hint">ä½ æœ€åœ¨æ„çš„ï¼šéŒ¢ä»€éº¼æ™‚å€™é€²ä¾†</div>
      </div>
      <p style="color: rgba(232,238,246,.66); font-size:.88rem; line-height:1.7; margin-bottom:.9rem;">
        ä»¥ä¸‹ç‚ºæœ¬æœˆå¯¦éš›ç™¼æ”¾æ—¥è³‡æ–™ã€‚æé†’ä¸€å¥ï¼šé…æ¯â‰ ç²åˆ©ï¼Œè©²ä¸è©²è¿½ã€è¦ä¸è¦è£œï¼Œé‚„æ˜¯è¦çœ‹ä½ è‡ªå·±çš„ç´€å¾‹èˆ‡é¢¨éšªæ‰¿å—åº¦ã€‚
      </p>
      <div id="dividendList"></div>
    </section>
  </main>

  <footer>
    <div class="footer-shell">
      <div>
        <div style="font-weight: 1000; color: rgba(255,255,255,.88); margin-bottom:.4rem;">è³‡æ–™ä¾†æºèˆ‡ä½œè€…</div>
        <div style="line-height:1.8;">
          ğŸ“Š è³‡æ–™ä¾†æºï¼š
          <a href="https://www.twse.com.tw/zh/ETFortune/announcementList" target="_blank" rel="noopener">è‡ºç£è­‰åˆ¸äº¤æ˜“æ‰€</a><br/>
          ğŸ¬ è£½ä½œï¼šå³é¦¬å…‹
        </div>
      </div>

      <div>
        <div style="font-weight: 1000; color: rgba(255,255,255,.88); margin-bottom:.4rem;">æŠ•è³‡é¢¨éšªæç¤º</div>
        <ul class="risk list-disc pl-5">
          <li>åŸºé‡‘é…æ¯ç‡â‰ å ±é…¬ç‡ï¼Œéå»é…æ¯ä¸ä»£è¡¨æœªä¾†ç¸¾æ•ˆã€‚</li>
          <li>æœ¬é è³‡æ–™åƒ…ä¾›æŠ•è³‡ç´€éŒ„åˆ†äº«èˆ‡ç†è²¡æ•™è‚²ï¼Œéå€‹åˆ¥åŒ–æŠ•è³‡å»ºè­°ã€‚</li>
          <li>ETF ç­‰é‡‘èå•†å“æœ‰æ¼²æœ‰è·Œï¼Œè«‹å¯©æ…è©•ä¼°è‡ªèº«é¢¨éšªæ‰¿å—åº¦ã€‚</li>
          <li>å¦‚éœ€å°ˆæ¥­å»ºè­°ï¼Œè«‹è«®è©¢åˆæ ¼é‡‘èé¡§å•ã€‚</li>
        </ul>
      </div>
    </div>

    <div style="text-align:center; margin-top: 1.2rem;">
      <a href="#wall" style="font-weight: 1000;">â†‘ å›åˆ°é ‚éƒ¨</a>
    </div>
  </footer>

  <script>
    /***********************
     * 2026 å°å‡ç´š v1 (ä¿®æ­£ç‰ˆ)
     * âœ… é¡¯ç¤ºæœˆä»½ä¸‹æ‹‰ï¼ˆåªé¡¯ç¤ºè³‡æ–™åº«è£¡çœŸçš„æœ‰çš„æœˆä»½ï¼‰
     * âœ… ä¸€éµåˆ‡æ›ï¼šçœ‹å…¬å‘Šæœˆ / çœ‹å…¥å¸³æœˆï¼ˆè§£æ±ºè·¨å¹´ï¼‰
     * âœ… æœå°‹ï¼ˆä»£è™Ÿ/åç¨±ï¼‰
     * âœ… æ’åºï¼ˆæ®–åˆ©ç‡/ç™¼æ”¾æ—¥/é…æ¯ï¼‰
     * âœ… é¦–å±æ‘˜è¦å¡ï¼ˆä¸‰å¼µï¼‰
     * âœ… URL åƒæ•¸ä¿å­˜ç‹€æ…‹ï¼ˆåˆ†äº«é€£çµå¥½ç”¨ï¼‰
     * âœ… è®€å–å¤±æ•—ç”¨ localStorage å¿«å–é™ç´šï¼ˆé é¢ä¸æœƒç©ºç™½ï¼‰
     ***********************/

    // âœ… å·²æ›´æ–°ç‚ºä½ æä¾›çš„æ­£ç¢ºé€£çµ
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSYJzDEa1_U_eq_Wh_Sr6VcSLENN2-Uit1wHBmx5qZS_-2EOg0WNAeSBg1lK4blObR3R88nH08j074W/pub?output=csv';

    // å¿«å– key
    const CACHE_KEY = 'mml_etf_div_wall_csv_cache_v1';
    const CACHE_TS_KEY = 'mml_etf_div_wall_csv_cache_ts_v1';

    // ğŸ”¹ å…¨åŸŸè®Šæ•¸ï¼šå…¨éƒ¨è³‡æ–™ + ç‹€æ…‹
    let allData = [];
    let axis = 'announce';      // 'announce' | 'pay'
    let selectedYM = null;      // 'YYYY-MM'
    let mode = 'forecast';      // 'forecast' | 'distribution'
    let q = '';                 // search query
    let sortBy = 'yield_desc';  // yield_desc | pay_asc | div_desc

    // æ‰‹æ©Ÿé¸å–®
    function toggleNav() {
      const nav = document.getElementById('navBar');
      nav.classList.toggle('active');
    }

    // å·¥å…·ï¼šä»£è™Ÿå»æ‰å‰ç½® 0
    function normalizeCode(code) {
      return (code || '').toString().trim().replace(/^0+/, '');
    }

    // å·¥å…·ï¼šæ•¸å­—æ ¼å¼åŒ–
    function formatAmount(n, digits = 2) {
      if (n === null || n === undefined || isNaN(n)) return '-';
      return Number(n).toLocaleString('zh-TW', {
        minimumFractionDigits: digits,
        maximumFractionDigits: digits
      });
    }

    // å·¥å…·ï¼šå®‰å…¨å–æ¬„ä½ï¼ˆé¿å…è¡¨é ­æœ‰æ™‚å«è‚¡è™Ÿã€æœ‰æ™‚å«è‚¡ç¥¨ä»£è™Ÿï¼‰
    function getField(r, keys) {
      for (const k of keys) {
        if (r && r[k] !== undefined && r[k] !== null && String(r[k]).trim() !== '') return r[k];
      }
      return '';
    }

    // å·¥å…·ï¼šè§£æå…¬å‘Šå¹´æœˆï¼ˆä¾†è‡ª è¥¿å…ƒ/æœˆä»½ï¼‰
    function getAnnounceYM(r) {
      const yRaw = getField(r, ['è¥¿å…ƒ', 'è¥¿å…ƒå¹´', 'å¹´']);
      const mRaw = getField(r, ['æœˆä»½', 'æœˆ']);
      const y = parseInt(String(yRaw).replace(/[^\d]/g,''), 10);
      const m = parseInt(String(mRaw).replace(/[^\d]/g,''), 10);
      if (!y || !m) return null;
      return `${y}-${String(m).padStart(2,'0')}`;
    }

    // å·¥å…·ï¼šè§£æå…¥å¸³å¹´æœˆï¼ˆä¾†è‡ª ç™¼æ”¾æ—¥ï¼Œè™•ç†è·¨å¹´ï¼šè‹¥å…¬å‘Š=12 ä¸” ç™¼æ”¾=1 -> å¹´+1ï¼‰
    function getPayYM(r) {
      const pay = (getField(r, ['ç™¼æ”¾æ—¥','é…ç™¼æ—¥','ç™¼æ”¾æ—¥æœŸ']) || '').toString().trim();
      if (!pay) return null;

      // å…è¨± 1/14ã€01/14ã€2026/01/14 é€™ç¨®
      const parts = pay.split('/').map(s => s.trim()).filter(Boolean);
      let mon = null, day = null, yearFromPay = null;

      if (parts.length === 3) {
        yearFromPay = parseInt(parts[0], 10);
        mon = parseInt(parts[1], 10);
        day = parseInt(parts[2], 10);
      } else if (parts.length === 2) {
        mon = parseInt(parts[0], 10);
        day = parseInt(parts[1], 10);
      }

      if (!mon || mon < 1 || mon > 12) return null;

      const ann = getAnnounceYM(r);
      if (!ann) {
        // æ²’å…¬å‘Šå¹´æœˆå°±ç”¨ã€Œç•¶å¹´ã€ï¼šé€™è£¡é€€è€Œæ±‚å…¶æ¬¡ç”¨ä»Šå¹´
        const now = new Date();
        return `${now.getFullYear()}-${String(mon).padStart(2,'0')}`;
      }

      const [ay, am] = ann.split('-').map(n => parseInt(n,10));
      let py = ay;

      // âœ… è·¨å¹´è¦å‰‡ï¼šå…¬å‘Š 12 æœˆã€å…¥å¸³ 1 æœˆ -> å¹´ + 1
      if (am === 12 && mon === 1) py = ay + 1;

      // è‹¥ç™¼æ”¾æ—¥æœ‰å¸¶å¹´ä»½ï¼Œå°±å°Šé‡å®ƒï¼ˆé¿å…è³‡æ–™æœ¬èº«å·²ç¶“å¯«å¹´ä»½ï¼‰
      if (yearFromPay && yearFromPay > 1900) py = yearFromPay;

      return `${py}-${String(mon).padStart(2,'0')}`;
    }

    // å·¥å…·ï¼šå–ã€Œè³‡æ–™åˆ—çš„ä»£è™Ÿ/åç¨±ã€
    function getCode(r) {
      return (getField(r, ['è‚¡è™Ÿ','è‚¡ç¥¨ä»£è™Ÿ','ä»£è™Ÿ']) || '').toString().trim();
    }
    function getName(r) {
      return (getField(r, ['è‚¡ç¥¨åç¨±','åŸºé‡‘åç¨±','åç¨±']) || '').toString().trim();
    }

    // å·¥å…·ï¼šæœ¬æœŸæ¯è‚¡é…æ¯ï¼ˆå¯¦éš›å„ªå…ˆã€æ²’æœ‰å°±é ä¼°ï¼‰
    function getPerShareDividend(r) {
      const actual = parseFloat(getField(r, ['å¯¦éš›é…æ¯']) || '');
      const est = parseFloat(getField(r, ['é ä¼°é…æ¯']) || '');
      if (!isNaN(actual) && actual > 0) return { value: actual, label: 'å¯¦éš›é…æ¯', raw: getField(r,['å¯¦éš›é…æ¯']) };
      if (!isNaN(est) && est > 0) return { value: est, label: 'é ä¼°é…æ¯', raw: getField(r,['é ä¼°é…æ¯']) };
      return { value: 0, label: 'é…æ¯', raw: '' };
    }

    // ğŸ”¹ æ‰¾ã€Œä¸Šä¸€ç­†é…æ¯ç´€éŒ„ã€ï¼ˆä»¥å…¬å‘Šå¹´æœˆæ’åºï¼šåŒä»£è™Ÿã€æ—©æ–¼ç•¶æœŸï¼‰
    function findPreviousDividendRecord(etfCode, curYM) {
      const target = normalizeCode(etfCode);
      let best = null;

      const [cy, cm] = (curYM || '').split('-').map(n => parseInt(n,10));
      if (!cy || !cm) return null;

      allData.forEach(r => {
        const code = normalizeCode(getCode(r));
        if (!code || code !== target) return;

        const ym = getAnnounceYM(r);
        if (!ym) return;
        const [y, m] = ym.split('-').map(n => parseInt(n,10));

        if (y < cy || (y === cy && m < cm)) {
          if (!best) best = r;
          else {
            const bym = getAnnounceYM(best);
            const [by,bm] = bym.split('-').map(n=>parseInt(n,10));
            if (y > by || (y === by && m > bm)) best = r;
          }
        }
      });

      return best;
    }

    // âœ… URL åƒæ•¸ï¼šè®€å–/å¯«å…¥
    function readStateFromURL() {
      const p = new URLSearchParams(location.search);
      const ax = p.get('axis');
      const mo = p.get('mode');
      const ym = p.get('month');
      const qq = p.get('q');
      const so = p.get('sort');

      if (ax === 'announce' || ax === 'pay') axis = ax;
      if (mo === 'forecast' || mo === 'distribution') mode = mo;
      if (ym && /^\d{4}-\d{2}$/.test(ym)) selectedYM = ym;
      if (qq !== null) q = (qq || '').trim();
      if (so && ['yield_desc','pay_asc','div_desc'].includes(so)) sortBy = so;
    }

    function writeStateToURL() {
      const p = new URLSearchParams(location.search);
      p.set('axis', axis);
      p.set('mode', mode);
      if (selectedYM) p.set('month', selectedYM);
      if (q) p.set('q', q); else p.delete('q');
      if (sortBy) p.set('sort', sortBy);
      const newUrl = `${location.pathname}?${p.toString()}${location.hash || ''}`;
      history.replaceState(null, '', newUrl);
    }

    // âœ… è»¸æŒ‰éˆ•æ–‡å­—
    function refreshAxisBtn() {
      const btn = document.getElementById('axisBtn');
      btn.textContent = axis === 'announce'
        ? 'çœ‹å…¬å‘Šï¼ˆé»åˆ‡æ›ï¼‰'
        : 'çœ‹å…¥å¸³ï¼ˆé»åˆ‡æ›ï¼‰';
    }

    // âœ… å–å¾—ã€Œå¯ç”¨æœˆä»½æ¸…å–®ã€ï¼ˆåªé¡¯ç¤ºè³‡æ–™åº«çœŸçš„æœ‰çš„æœˆä»½ï¼‰
    function getAvailableMonths() {
      const set = new Set();
      allData.forEach(r => {
        const ym = axis === 'announce' ? getAnnounceYM(r) : getPayYM(r);
        if (ym) set.add(ym);
      });
      // æ–°â†’èˆŠ
      return Array.from(set).sort((a,b) => b.localeCompare(a));
    }

    function renderMonthSelect() {
      const sel = document.getElementById('monthSelect');
      const list = getAvailableMonths();

      sel.innerHTML = '';
      list.forEach(ym => {
        const opt = document.createElement('option');
        opt.value = ym;
        opt.textContent = ym;
        sel.appendChild(opt);
      });

      // é¸ä¸åˆ°å°±ç”¨æœ€æ–°ä¸€ç­†
      if (!selectedYM || !list.includes(selectedYM)) selectedYM = list[0] || null;
      if (selectedYM) sel.value = selectedYM;
    }

    // âœ… æœ¬æœˆè³‡æ–™ï¼ˆä¾ axis å–å°æ‡‰æœˆä»½ï¼‰
    function getMonthData() {
      if (!selectedYM) return [];
      return allData.filter(r => {
        const ym = axis === 'announce' ? getAnnounceYM(r) : getPayYM(r);
        return ym === selectedYM;
      });
    }

    // âœ… æœå°‹ç¯©é¸ï¼ˆä»£è™Ÿ/åç¨±ï¼‰
    function applySearch(data) {
      const kw = (q || '').trim().toLowerCase();
      if (!kw) return data;

      return data.filter(r => {
        const code = (getCode(r) || '').toLowerCase();
        const name = (getName(r) || '').toLowerCase();
        return code.includes(kw) || name.includes(kw);
      });
    }

    // âœ… æ’åº
    function applySort(data) {
      const arr = [...data];

      if (sortBy === 'yield_desc') {
        arr.sort((a,b) => {
          const ya = parseFloat(getField(a,['å–®æœŸæ®–åˆ©ç‡']) || '') || 0;
          const yb = parseFloat(getField(b,['å–®æœŸæ®–åˆ©ç‡']) || '') || 0;
          return yb - ya;
        });
      } else if (sortBy === 'div_desc') {
        arr.sort((a,b) => {
          const da = getPerShareDividend(a).value || 0;
          const db = getPerShareDividend(b).value || 0;
          return db - da;
        });
      } else if (sortBy === 'pay_asc') {
        arr.sort((a,b) => {
          // ä»¥ã€Œç™¼æ”¾æ—¥ã€æœˆä»½æ—¥æ’åºï¼ˆåŒæœˆå…§ï¼‰
          const pa = (getField(a,['ç™¼æ”¾æ—¥','é…ç™¼æ—¥']) || '').toString();
          const pb = (getField(b,['ç™¼æ”¾æ—¥','é…ç™¼æ—¥']) || '').toString();
          const da = parsePayDayForSort(pa);
          const db = parsePayDayForSort(pb);
          return da - db;
        });
      }

      return arr;
    }

    function parsePayDayForSort(s) {
      if (!s) return 9999;
      const parts = s.toString().trim().split('/').map(x=>x.trim()).filter(Boolean);
      let mon=null, day=null;
      if (parts.length === 3) { mon = parseInt(parts[1],10); day = parseInt(parts[2],10); }
      if (parts.length === 2) { mon = parseInt(parts[0],10); day = parseInt(parts[1],10); }
      if (!mon || !day) return 9999;
      return mon*100 + day;
    }

    // âœ… æ‘˜è¦å¡
    function renderSummary(dataRaw) {
      const grid = document.getElementById('summaryGrid');
      const data = dataRaw.filter(r => getPerShareDividend(r).value > 0);

      document.getElementById('sumCount').textContent = `${data.length} æª”`;

      // ä¸­ä½æ•¸æ®–åˆ©ç‡ï¼ˆç”¨ å–®æœŸæ®–åˆ©ç‡ æ¬„ä½ï¼Œ% å­—ä¸²ä¹Ÿ OKï¼‰
      const yields = data
        .map(r => {
          const y = (getField(r,['å–®æœŸæ®–åˆ©ç‡']) || '').toString().replace('%','').trim();
          const n = parseFloat(y);
          return isNaN(n) ? null : n;
        })
        .filter(v => v !== null)
        .sort((a,b)=>a-b);

      let median = '-';
      if (yields.length) {
        const mid = Math.floor(yields.length/2);
        const m = yields.length % 2 ? yields[mid] : (yields[mid-1] + yields[mid]) / 2;
        median = `${m.toFixed(2)}%`;
      }
      document.getElementById('sumMedian').textContent = median;

      // æœ€é«˜æ®–åˆ©ç‡
      let top = { code: '-', y: -1 };
      data.forEach(r => {
        const code = getCode(r);
        const y = parseFloat((getField(r,['å–®æœŸæ®–åˆ©ç‡']) || '').toString().replace('%','')) || 0;
        if (y > top.y) top = { code, y };
      });
      document.getElementById('sumTop').textContent = top.y >= 0 ? `${top.code}ï½œ${top.y.toFixed(2)}%` : '-';

      grid.style.display = 'grid';
    }

    // å‰äº”åæ’è¡Œï¼ˆç”¨ã€Œé ä¼°é…æ¯ Ã· æ”¶ç›¤åƒ¹ã€ï¼‰
    function renderTop5(data) {
      const c = document.getElementById('top5-cards');
      c.innerHTML = '';

      const list = data
        .filter(r => getField(r,['é ä¼°é…æ¯']) && getField(r,['æ”¶ç›¤åƒ¹']))
        .map(r => {
          const est = parseFloat(getField(r,['é ä¼°é…æ¯']));
          const close = parseFloat(getField(r,['æ”¶ç›¤åƒ¹']));
          const rate = close ? (est / close) * 100 : NaN;
          return {
            code: getCode(r),
            name: getName(r),
            rate
          };
        })
        .filter(r => !isNaN(r.rate))
        .sort((a, b) => b.rate - a.rate)
        .slice(0, 5);

      const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];

      list.forEach((r, i) => {
        const card = document.createElement('div');
        card.className = 'top5-card';
        card.innerHTML = `
          <div style="font-size:2rem; margin-bottom:.2rem;">${medals[i]}</div>
          <div class="code">${r.code}</div>
          <div class="name">${r.name || ''}</div>
          <div class="rate">${r.rate.toFixed(2)}%</div>
        `;
        c.appendChild(card);
      });
    }

    // ğŸ”¹ ç€‘å¸ƒç‰†å¡ç‰‡ï¼ˆå«ã€Œèˆ‡ä¸Šæ¬¡é…æ¯æ¯”è¼ƒã€ï¼‰
    function renderCards(data) {
      const c = document.getElementById('card-container');
      c.innerHTML = '';
      document.getElementById('loading').style.display = 'none';

      if (!data.length) {
        c.innerHTML = `<div style="grid-column:1/-1; text-align:center; color: rgba(232,238,246,.62); padding: 1rem 0;">é€™å€‹æœˆä»½æ‰¾ä¸åˆ°ç¬¦åˆçš„è³‡æ–™ï¼ˆæˆ–è¢«æœå°‹æ¢ä»¶ç¯©æ‰äº†ï¼‰</div>`;
        return;
      }

      data.forEach(r => {
        const code = getCode(r);
        const name = getName(r);
        const freq = getField(r,['é…æ¯é »ç‡']) || '';
        const close = getField(r,['æ”¶ç›¤åƒ¹']) || '-';
        const yieldRate = getField(r,['å–®æœŸæ®–åˆ©ç‡']) || '-';
        const exDate = getField(r,['é™¤æ¯æ—¥']) || '-';
        const payDate = getField(r,['ç™¼æ”¾æ—¥','é…ç™¼æ—¥']) || '-';

        const divInfo = getPerShareDividend(r);
        const perShare = divInfo.value;
        const actualDivRaw = getField(r,['å¯¦éš›é…æ¯']);
        const estDivRaw = getField(r,['é ä¼°é…æ¯']);

        // æ‰¾ä¸Šä¸€ç­†ï¼ˆä»¥å…¬å‘Šå¹´æœˆæ¯”è¼ƒæœ€åˆç†ï¼‰
        const prev = findPreviousDividendRecord(code, getAnnounceYM(r));
        let diffHtml = 'è¼ƒä¸Šæ¬¡é…æ¯ï¼šâ€”';

        if (prev) {
          const prevInfo = getPerShareDividend(prev);
          const prevDiv = prevInfo.value;
          if (perShare > 0 && prevDiv > 0) {
            const diff = perShare - prevDiv;
            const pct = (diff / prevDiv) * 100;

            let arrow = 'â–¬';
            let color = 'rgba(232,238,246,.62)';
            if (diff > 0) { arrow = 'â–²'; color = 'rgba(52,211,153,.95)'; }
            else if (diff < 0) { arrow = 'â–¼'; color = 'rgba(248,113,113,.95)'; }

            diffHtml = `è¼ƒä¸Šæ¬¡é…æ¯ï¼š<span style="color:${color}; font-weight:1000;">${arrow} ${diff > 0 ? '+' : ''}${diff.toFixed(3)} å…ƒï¼ˆ${diff > 0 ? '+' : ''}${pct.toFixed(1)}%ï¼‰</span>`;
          }
        }

        const label = actualDivRaw ? 'å¯¦éš›é…æ¯' : 'é ä¼°é…æ¯';
        const showDiv = actualDivRaw || estDivRaw || '-';

        const card = document.createElement('div');
        card.className = 'etf-card';
        card.innerHTML = `
          <div class="head">
            <div class="code-big">${code}</div>
            <div class="badge-freq">${freq}</div>
          </div>
          <div class="etf-name">${name}</div>

          <div class="two-box">
            <div class="info-box accent">
              <div class="label">${label}</div>
              <div class="value">${showDiv}</div>
            </div>
            <div class="info-box">
              <div class="label">æœ€å¾Œè²·é€²æ—¥</div>
              <div class="value" style="font-size:1.05rem;">${getField(r,['æœ€å¾Œè²·é€²æ—¥']) || '-'}</div>
            </div>
          </div>

          <div class="mini-grid">
            <div class="mini">
              <div class="k">æ”¶ç›¤åƒ¹</div>
              <div class="v">${close}</div>
            </div>
            <div class="mini">
              <div class="k">æ®–åˆ©ç‡</div>
              <div class="v">${yieldRate}</div>
            </div>
            <div class="mini">
              <div class="k">é™¤æ¯æ—¥</div>
              <div class="v">${exDate}</div>
            </div>
          </div>

          <div class="footrow">
            <div>é…ç™¼æ—¥ï¼š${payDate}</div>
            <div>${diffHtml}</div>
          </div>
        `;
        c.appendChild(card);
      });
    }

    // æ”¶ç›Šçµ„æˆå¡ç‰‡
    function renderComposition(data) {
      const comp = document.getElementById('composition-container');
      comp.innerHTML = '';

      if (!data.length) {
        comp.innerHTML = `<div style="grid-column:1/-1; text-align:center; color: rgba(232,238,246,.62); padding: 1rem 0;">é€™å€‹æœˆä»½æ‰¾ä¸åˆ°ç¬¦åˆçš„è³‡æ–™ï¼ˆæˆ–è¢«æœå°‹æ¢ä»¶ç¯©æ‰äº†ï¼‰</div>`;
        return;
      }

      data.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card-common';
        card.innerHTML = `
          <h3>${getCode(r)}</h3>
          <div class="etf-name">${getName(r) || ''}</div>
          <div class="grid grid-cols-3 gap-3">
            <div class="highlight"><div class="t">å¹´åˆè‡³ä»Šå ±é…¬</div><div class="v">${getField(r,['å¹´åˆè‡³ä»Šå ±é…¬']) || '-'}</div></div>
            <div class="highlight"><div class="t">å¯¦éš›é…æ¯</div><div class="v">${getField(r,['å¯¦éš›é…æ¯']) || '-'}</div></div>
            <div class="highlight"><div class="t">è‚¡åˆ©æ‰€å¾—</div><div class="v">${getField(r,['è‚¡åˆ©æ‰€å¾—']) || '-'}</div></div>
            <div class="highlight"><div class="t">54C</div><div class="v">${getField(r,['54C']) || '-'}</div></div>
            <div class="highlight"><div class="t">åˆ©æ¯æ‰€å¾—</div><div class="v">${getField(r,['åˆ©æ¯æ‰€å¾—']) || '-'}</div></div>
            <div class="highlight"><div class="t">æ”¶ç›Šå¹³æº–é‡‘</div><div class="v">${getField(r,['æ”¶ç›Šå¹³æº–é‡‘']) || '-'}</div></div>
            <div class="highlight"><div class="t">è³‡æœ¬åˆ©å¾—</div><div class="v">${getField(r,['è³‡æœ¬åˆ©å¾—']) || '-'}</div></div>
            <div class="highlight"><div class="t">å…¶ä»–æ‰€å¾—</div><div class="v">${getField(r,['å…¶ä»–æ‰€å¾—']) || '-'}</div></div>
            <div class="highlight"><div class="t">å¥ä¿æ‡‰èª²å¼µæ•¸</div><div class="v">${getField(r,['å¥ä¿æ‡‰èª²å¼µæ•¸']) || '-'}</div></div>
          </div>`;
        comp.appendChild(card);
      });
    }

    // é…æ¯æ™‚é–“è¡¨ï¼ˆæ°¸é ç”¨ã€Œå…¥å¸³æœˆã€é‚è¼¯å‘ˆç¾ï¼šå³ä½¿ä½ åœ¨çœ‹å…¬å‘Šæœˆï¼Œé€™å¡Šé‚„æ˜¯çœ‹éŒ¢ä½•æ™‚åˆ°ï¼‰
    function renderTimeline(allRowsInSelectedMonth) {
      const div = document.getElementById('dividendList');
      div.innerHTML = '';

      // é€™è£¡ç”¨ selectedYM ç•¶ä½œã€Œå…¥å¸³æœˆã€ä¾†æŠ“
      const ym = selectedYM;
      if (!ym) return;

      const timelineRows = allData.filter(r => getPayYM(r) === ym);

      if (timelineRows.length === 0) {
        div.innerHTML = '<p style="text-align:center; color: rgba(232,238,246,.62);">âš ï¸ é€™å€‹æœˆä»½æ²’æœ‰å…¥å¸³è³‡æ–™</p>';
        return;
      }

      const groups = {};
      timelineRows.forEach(r => {
        const date = (getField(r,['ç™¼æ”¾æ—¥','é…ç™¼æ—¥']) || '').toString().trim();
        if (!date) return;
        groups[date] = groups[date] || [];
        groups[date].push(r);
      });

      Object.keys(groups)
        .sort((a, b) => parsePayDayForSort(a) - parsePayDayForSort(b))
        .forEach(date => {
          const card = document.createElement('div');
          card.className = 'timeline-card';

          card.innerHTML = `
            <div class="timeline-head">
              <span class="tag-date">ç™¼æ”¾æ—¥</span>
              <span>${date}</span>
            </div>
            <div>
              ${groups[date].map(etf => {
                const divInfo = getPerShareDividend(etf);
                const show = getField(etf,['å¯¦éš›é…æ¯']) || getField(etf,['é ä¼°é…æ¯']) || '-';
                return `
                  <div class="timeline-row">
                    <div class="timeline-code">${getCode(etf)}</div>
                    <div class="timeline-name">${getName(etf) || ''}</div>
                    <div class="timeline-val">æ¯è‚¡ ${show} å…ƒ</div>
                  </div>
                `;
              }).join('')}
            </div>
          `;
          div.appendChild(card);
        });
    }

    // ğŸ”¹ ä½ çš„ETFé…æ¯è©¦ç®—ï¼ˆä¿®æ­£ç‰ˆï¼‰
    function handleMyDividendCalc() {
      const codeInput = document.getElementById('my-dividend-code').value;
      const lotsInput = document.getElementById('my-dividend-lots').value;
      const resultDiv = document.getElementById('my-dividend-result');

      if (!allData || allData.length === 0) {
        resultDiv.innerHTML = 'è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™å†è©¦ ğŸ™';
        return;
      }

      // 1. å…ˆå®šç¾©æŒæœ‰è‚¡æ•¸
      const shares = parseFloat(lotsInput || '0');
      if (!shares || shares <= 0) {
        resultDiv.innerHTML = 'è«‹è¼¸å…¥æ­£ç¢ºçš„æŒæœ‰è‚¡æ•¸ï¼ˆå¯ä»¥æ˜¯é›¶è‚¡ï¼‰';
        return;
      }

      const norm = normalizeCode(codeInput);

      // ç”¨ selectedYM + axis ç¯©æœ¬æœŸè³‡æ–™
      const candidates = allData.filter(r => {
        const ym = axis === 'announce' ? getAnnounceYM(r) : getPayYM(r);
        const code = normalizeCode(getCode(r));
        return ym === selectedYM && code === norm;
      });

      if (!candidates.length) {
        resultDiv.innerHTML = `æ‰¾ä¸åˆ°é€™å€‹æœˆä»½ä»£è™Ÿ <strong style="font-family: monospace;">${codeInput}</strong> çš„è³‡æ–™ï¼Œå¯èƒ½æœ¬æœŸæ²’æœ‰é…æ¯ï¼Œæˆ–ä½ ç›®å‰åœ¨çœ‹ã€Œ${axis === 'announce' ? 'å…¬å‘Šæœˆ' : 'å…¥å¸³æœˆ'}ã€ã€‚`;
        return;
      }

      const r = candidates[0];
      const code = getCode(r);
      const name = getName(r);
      const exDate = getField(r,['é™¤æ¯æ—¥']) || '-';
      const payDate = getField(r,['ç™¼æ”¾æ—¥','é…ç™¼æ—¥']) || '-';

      const divInfo = getPerShareDividend(r);
      const perShare = divInfo.value;

      if (!perShare) {
        resultDiv.innerHTML = `æœ‰æ‰¾åˆ° <strong>${code}</strong>ï¼ˆ${name}ï¼‰ï¼Œä½†æœ¬æœŸé…æ¯é‡‘é¡å°šæœªå…¬å¸ƒï¼ˆæˆ–è³‡æ–™ç‚ºç©ºï¼‰ï¼Œæš«æ™‚ç„¡æ³•ä¼°ç®— ğŸ’­`;
        return;
      }

      const total = perShare * shares;
      const label = divInfo.label;

      // æ‰¾ä¸Šä¸€ç­†é…æ¯
      const prev = findPreviousDividendRecord(code, getAnnounceYM(r));
      let prevText = 'è¼ƒä¸Šæ¬¡é…æ¯ï¼šâ€”';
      if (prev) {
        const prevInfo = getPerShareDividend(prev);
        const prevDiv = prevInfo.value;
        if (prevDiv > 0) {
          const diff = perShare - prevDiv;
          const pct = (diff / prevDiv) * 100;
          let arrow = 'â–¬';
          let color = 'rgba(232,238,246,.62)';
          if (diff > 0) { arrow = 'â–²'; color = 'rgba(52,211,153,.95)'; }
          else if (diff < 0) { arrow = 'â–¼'; color = 'rgba(248,113,113,.95)'; }

          prevText = `è¼ƒä¸Šæ¬¡é…æ¯ï¼š<span style="color:${color}; font-weight:1000;">${arrow} ${diff > 0 ? '+' : ''}${diff.toFixed(3)} å…ƒï¼ˆ${diff > 0 ? '+' : ''}${pct.toFixed(1)}%ï¼‰</span>`;
        }
      }

      resultDiv.innerHTML = `
      <div style="display:grid; gap:.35rem;">
        <div>ä½ æŒæœ‰ <strong>${shares.toLocaleString()}</strong> è‚¡ <strong>${code}</strong>ï¼ˆ${name}ï¼‰ã€‚</div>
        <div>æœ¬æœŸæ¯è‚¡${label}ï¼š<strong>${perShare.toFixed(3)} å…ƒ</strong></div>
        <div>ğŸ‘‰ æœ¬æœŸé ä¼°å¯é ˜é…æ¯ç´„ï¼š
          <span class="money">${formatAmount(total)} å…ƒ</span>
        </div>
        <div style="font-size:.8rem; color: rgba(232,238,246,.62);">
          é™¤æ¯æ—¥ï¼š${exDate}ï½œé…ç™¼æ—¥ï¼š${payDate}
        </div>
        <div style="font-size:.82rem;">${prevText}</div>
      </div>
      `;
    }

    // âœ… ä¸€æ¬¡æ¸²æŸ“å…¨éƒ¨ï¼ˆä¾ç›®å‰ç‹€æ…‹ï¼‰
    function renderAll() {
      if (!allData.length) return;

      refreshAxisBtn();
      renderMonthSelect();

      // å·¥å…·åˆ—å›å¡«
      document.getElementById('searchInput').value = q || '';
      document.getElementById('sortSelect').value = sortBy || 'yield_desc';

      // Header
      const [yy, mm] = (selectedYM || '').split('-');
      document.getElementById('timeline-header').textContent = `ğŸ“… ${yy}å¹´ ${mm}æœˆ ETFé…æ¯å…¥å¸³æ™‚é–“è¡¨`;

      // å–æœ¬æœˆï¼ˆä¾ axisï¼‰
      let data = getMonthData();
      // æœå°‹ + æ’åº
      data = applySearch(data);
      data = applySort(data);

      // æ‘˜è¦ï¼ˆç”¨æœå°‹å¾Œçš„è³‡æ–™æ›´ç›´è¦ºï¼‰
      renderSummary(data);

      // Top5ï¼ˆåªåœ¨ forecast æ¨¡å¼é¡¯ç¤ºï¼Œä½†è³‡æ–™å…ˆç®—æ²’å·®ï¼‰
      renderTop5(data);

      // å¡ç‰‡/çµ„æˆ/æ™‚é–“è¡¨
      renderCards(data);
      renderComposition(data);
      renderTimeline(data);

      // è¨˜éŒ„ URL ç‹€æ…‹
      writeStateToURL();
    }

    // âœ… ç‹€æ…‹æç¤ºåˆ—ï¼ˆå–ä»£ä½ é‚£æ®µè¶…é•· debugï¼‰
    function setStatus(type, msg) {
      const el = document.getElementById('statusLine');
      const cls = type === 'ok' ? 'ok' : type === 'warn' ? 'warn' : 'bad';
      el.innerHTML = `<span class="${cls}">â—</span> ${msg}`;
    }

    // âœ… è®€å– CSVï¼ˆå…ˆç¶²è·¯ã€å¤±æ•—å°±ç”¨å¿«å–ï¼‰
    async function loadCSVWithFallback() {
      setStatus('warn', 'è³‡æ–™è¼‰å…¥ä¸­â€¦');

      try {
        const res = await fetch(csvUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();

        // ç°¡å–®åˆ¤æ–·åƒä¸åƒ CSV
        if (!text.includes(',') || !text.toLowerCase().includes('è¥¿å…ƒ')) {
          // ä»å¯èƒ½æ˜¯ CSVï¼Œä½†è‡³å°‘ä¸è¦ç›´æ¥ç•¶æˆåŠŸ
          throw new Error('å…§å®¹ä¸åƒCSV');
        }

        localStorage.setItem(CACHE_KEY, text);
        localStorage.setItem(CACHE_TS_KEY, String(Date.now()));
        return { text, fromCache: false };
      } catch (e) {
        const cached = localStorage.getItem(CACHE_KEY);
        if (cached) {
          return { text: cached, fromCache: true };
        }
        throw e;
      }
    }

    function parseCSVTextToData(csvText) {
      const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
      return (parsed.data || []).filter(r => r && (getCode(r) || getName(r)));
    }

    function initModeButtons() {
      // æŒ‰éˆ•é è¨­
      document.querySelectorAll('#mode-switch button').forEach(btn => {
        const m = btn.dataset.mode;
        if (m === mode) {
          btn.classList.remove('btn-ghost');
          btn.classList.add('btn-primary');
        } else {
          btn.classList.remove('btn-primary');
          btn.classList.add('btn-ghost');
        }
      });

      // é¡¯ç¤ºå€å¡Š
      document.getElementById('mode-forecast').style.display = mode === 'forecast' ? 'block' : 'none';
      document.getElementById('mode-distribution').style.display = mode === 'distribution' ? 'block' : 'none';

      document.querySelectorAll('#mode-switch button').forEach(btn => {
        btn.addEventListener('click', () => {
          mode = btn.dataset.mode;

          document.getElementById('mode-forecast').style.display = mode === 'forecast' ? 'block' : 'none';
          document.getElementById('mode-distribution').style.display = mode === 'distribution' ? 'block' : 'none';

          document.querySelectorAll('#mode-switch button').forEach(b => {
            if (b.dataset.mode === mode) {
              b.classList.remove('btn-ghost');
              b.classList.add('btn-primary');
            } else {
              b.classList.remove('btn-primary');
              b.classList.add('btn-ghost');
            }
          });

          renderAll();
        });
      });
    }

    // âœ… åˆå§‹åŒ–
    (async function boot() {
      readStateFromURL();
      refreshAxisBtn();
      initModeButtons();

      // äº‹ä»¶ç¶å®šï¼šæœˆä»½
      document.getElementById('monthSelect').addEventListener('change', (e) => {
        selectedYM = e.target.value;
        renderAll();
      });

      // äº‹ä»¶ç¶å®šï¼šè»¸åˆ‡æ›ï¼ˆçœ‹å…¬å‘Š/çœ‹å…¥å¸³ï¼‰
      document.getElementById('axisBtn').addEventListener('click', () => {
        axis = axis === 'announce' ? 'pay' : 'announce';
        // åˆ‡è»¸å¾Œé‡æ–°ç®—ã€Œå¯ç”¨æœˆä»½ã€ï¼Œè‹¥åŸæœ¬æœˆä»½ä¸å­˜åœ¨å°±è‡ªå‹•è·³åˆ°æœ€æ–°
        renderAll();
      });

      // äº‹ä»¶ç¶å®šï¼šæœå°‹
      let searchTimer = null;
      document.getElementById('searchInput').addEventListener('input', (e) => {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(() => {
          q = (e.target.value || '').trim();
          renderAll();
        }, 120);
      });

      // äº‹ä»¶ç¶å®šï¼šæ’åº
      document.getElementById('sortSelect').addEventListener('change', (e) => {
        sortBy = e.target.value;
        renderAll();
      });

      // ç¶å®šã€Œä½ çš„ETFé…å¤šå°‘ï¼Ÿã€æŒ‰éˆ•
      document.getElementById('my-dividend-btn').addEventListener('click', handleMyDividendCalc);

      // è®€å–è³‡æ–™
      try {
        const { text, fromCache } = await loadCSVWithFallback();
        allData = parseCSVTextToData(text);

        const upd = (allData[0] && getField(allData[0], ['æ›´æ–°æ—¥æœŸ','æ›´æ–°æ™‚é–“'])) || '';
        if (upd) document.getElementById('last-update').textContent = `æ›´æ–°æ™‚é–“ï¼š${upd}`;

        const ts = localStorage.getItem(CACHE_TS_KEY);
        if (fromCache) {
          const t = ts ? new Date(parseInt(ts,10)) : null;
          const tStr = t ? `${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,'0')}/${String(t.getDate()).padStart(2,'0')} ${String(t.getHours()).padStart(2,'0')}:${String(t.getMinutes()).padStart(2,'0')}` : 'â€”';
          setStatus('warn', `ç›®å‰ä½¿ç”¨å¿«å–è³‡æ–™ï¼ˆä¸Šæ¬¡æˆåŠŸï¼š${tStr}ï¼‰ã€‚ç¶²è·¯è‹¥æ­£å¸¸ï¼Œé‡æ–°æ•´ç†æœƒè‡ªå‹•æ›´æ–°ã€‚`);
        } else {
          setStatus('ok', `è³‡æ–™è¼‰å…¥å®Œæˆï¼ˆå…± ${allData.length} ç­†ï¼‰ã€‚`);
        }

        // é¦–æ¬¡æ¸²æŸ“ï¼šæœˆä¸‹æ‹‰åªé¡¯ç¤ºè³‡æ–™åº«çœŸçš„æœ‰çš„æœˆä»½ï¼ˆä¸æœƒå†å‡ºç¾ 2026-08 é€™ç¨®å¹½éˆæœˆï¼‰
        renderAll();
      } catch (e) {
        document.getElementById('loading').style.display = 'none';
        setStatus('bad', 'è³‡æ–™è®€å–å¤±æ•—ï¼šç›®å‰æ²’æœ‰å¿«å–å¯ç”¨ã€‚è«‹ç¨å¾Œé‡æ•´æˆ–æª¢æŸ¥ Google Sheet ç™¼ä½ˆç‹€æ…‹ã€‚');
      }
    })();
  </script>
</body>
</html>
