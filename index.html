<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>吳馬克的複利試算工具｜馬克理財</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #F5F2E9;
      color: #1A1A1A;
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }
    h1 {
      color: #2D3C2F;
      text-align: center;
    }
    .tagline {
      text-align: center;
      font-size: 1rem;
      color: #888;
      margin-top: -1rem;
      margin-bottom: 2rem;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      margin-top: 2rem;
    }
    .form-section, .table-section {
      flex: 1 1 400px;
      background-color: #F5F2E9;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
    button {
      margin-top: 1.5rem;
      background-color: #2D3C2F;
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
      text-align: right;
    }
    th {
      background-color: #FFD54F;
      color: #1A1A1A;
    }
    .highlight {
      background-color: #B2D7E7;
    }
    canvas {
      margin-top: 3rem;
    }
  </style>
</head>
<body>
  <header style="background-color:#2D3C2F; padding: 1rem 2rem; color: white; display: flex; justify-content: space-between; align-items: center; font-size: 1.2rem;">
    <div style="font-weight: bold;">吳馬克｜幸福理財家 工具</div>
    <nav>
      <a href="/" style="color: white; margin-left: 1rem; text-decoration: none;">首頁</a>
      <a href="/tools" style="color: white; margin-left: 1rem; text-decoration: none;">工具列表</a>
      <a href="/about" style="color: white; margin-left: 1rem; text-decoration: none;">關於馬克</a>
      <a href="https://www.youtube.com/user/rengary" target="_blank" style="color: #FFD54F; margin-left: 1.5rem; text-decoration: none; font-weight: bold;">📺 YouTube 頻道</a>
    </nav>
  </header>

  <h1>複利試算工具</h1>
  <p class="tagline">馬克理財頻道 × 長期投資 × 股息累積試算</p>

  <div class="container">
    <div class="form-section">
      <label>目前年齡</label>
      <input type="number" id="startAge" value="25" />
      <label>開始年份</label>
      <input type="number" id="startYear" value="2025" />
      <label>開始月份</label>
      <select id="startMonth">
        <option value="0">1 月</option>
        <option value="1">2 月</option>
        <option value="2">3 月</option>
        <option value="3">4 月</option>
        <option value="4">5 月</option>
        <option value="5">6 月</option>
        <option value="6">7 月</option>
        <option value="7">8 月</option>
        <option value="8">9 月</option>
        <option value="9">10 月</option>
        <option value="10">11 月</option>
        <option value="11">12 月</option>
      </select>
      <label>初始金額</label>
      <input type="number" id="startAmount" value="0" />
      <label>每月投入金額</label>
      <input type="number" id="monthly" value="10000" />
      <label>年報酬率 (%)</label>
      <input type="number" id="rate" value="6" />
      <label>投入年數</label>
      <input type="number" id="years" value="20" />
      <button onclick="calculateGrowth()">計算</button>
    </div>

    <div class="table-section">
      <table id="resultTable">
        <thead>
          <tr>
            <th>年齡</th>
            <th>年份</th>
            <th>投入金額</th>
            <th>累積金額</th>
            <th>預估配息</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <canvas id="resultChart" height="120"></canvas>
  <canvas id="stackedChart" height="120"></canvas>

  <footer style="margin-top: 4rem; text-align: center; font-size: 0.9rem; color: #888;">
    本工具由 <strong>吳馬克｜幸福理財家</strong> 製作｜<a href="https://markmoneylife.com/" target="_blank">返回主網站</a>
  </footer>

  <script>
    function calculateGrowth() {
      const startAge = parseInt(document.getElementById('startAge').value);
      const startAmount = parseFloat(document.getElementById('startAmount').value);
      const monthly = parseFloat(document.getElementById('monthly').value);
      const rate = parseFloat(document.getElementById('rate').value) / 100;
      const years = parseInt(document.getElementById('years').value);
      const dividendRate = rate;
      const startYear = parseInt(document.getElementById('startYear').value);
      const startMonth = parseInt(document.getElementById('startMonth').value);
      const yearlyInvestment = monthly * 12;
      const firstYearMonths = 12 - startMonth;
      const firstYearInvestment = monthly * firstYearMonths;

      let total = startAmount;
      let dividend = 0;
      const tableBody = document.querySelector("#resultTable tbody");
      const data = [];
      const invested = [];
      const labels = [];
      tableBody.innerHTML = "";

      for (let i = 0; i <= years; i++) {
        const age = startAge + i;
        const year = startYear + i;
        const newInvestment = i === 0 ? firstYearInvestment : yearlyInvestment + dividend;
        total += total * rate + newInvestment;
        dividend = total * dividendRate;
        data.push(total);
        invested.push(newInvestment + (invested[i - 1] || 0));

        labels.push(`${year} 年`);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${age}</td>
          <td>${year}</td>
          <td>$${Math.round(newInvestment).toLocaleString()}</td>
          <td>$${Math.round(total).toLocaleString()}</td>
          <td>$${Math.round(dividend).toLocaleString()}</td>
        `;
        tableBody.appendChild(tr);
      }

      const ctx1 = document.getElementById('resultChart').getContext('2d');
      if (window.resultChart) window.resultChart.destroy();
      window.resultChart = new Chart(ctx1, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: '預估配息',
            data: data.map(d => d * dividendRate),
            backgroundColor: '#FFD54F',
            borderRadius: 6
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      const ctx2 = document.getElementById('stackedChart').getContext('2d');
      if (window.stackedChart) window.stackedChart.destroy();
      window.stackedChart = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: '投入資金',
              data: invested,
              backgroundColor: '#B2D7E7',
              stack: 'stack1'
            },
            {
              label: '資產增長',
              data: data.map((val, idx) => val - invested[idx]),
              backgroundColor: '#2D3C2F',
              stack: 'stack1'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        }
      });
    }

    calculateGrowth();
  </script>
</body>
</html>
