<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- âœ… Page / SEO -->
  <title>æŠ•è³‡æ˜ŸçƒåŸºåœ°ï½œé…æ¯ç´€éŒ„å„€è¡¨æ¿ï¼ˆè‡ªå‹•è¨˜ä½ï¼‹åŒæ­¥ Google Sheetï¼‰ï½œMark Money Life</title>
  <meta name="description" content="æŠ•è³‡æ˜ŸçƒåŸºåœ°ï¼šè¼¸å…¥æœ¬æœˆé…æ¯ã€å¹´åº¦ç´¯ç©èˆ‡å¹´åº¦ç›®æ¨™ï¼Œè‡ªå‹•è¨˜ä½è¨­å®šï¼ˆLocalStorageï¼‰ï¼Œä¸¦å¯ä¸€éµåŒæ­¥åˆ° Google Sheetï¼Œå›ä¾†å°±èƒ½çœ‹åˆ°è‡ªå·±çš„é…æ¯é€²åº¦ã€‚å³é¦¬å…‹ Mark Money Lifeã€‚">
  <link rel="canonical" href="https://markmoneylife.github.io/compound-interest-tool/invest-base.html" />

  <!-- âœ… Slug å»ºè­°ï¼šinvest-base / dividend-base / starbase -->
  <meta name="keywords" content="é…æ¯ç´€éŒ„,ETFé…æ¯,å¹´åº¦é…æ¯ç´¯ç©,æŠ•è³‡å„€è¡¨æ¿,é…æ¯ç›®æ¨™,LocalStorage,Google SheetåŒæ­¥,å³é¦¬å…‹,Mark Money Life">

  <style>
    :root{
      --bg:#050b15; --card:rgba(255,255,255,.06); --bd:rgba(255,255,255,.10);
      --txt:#eaf1ff; --mut:#a9b7d6; --good:#25c06d; --warn:#f6c343; --bad:#ff5b5b;
    }
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC","Noto Sans TC",sans-serif; color:var(--txt);
      background: radial-gradient(1200px 800px at 20% 10%, rgba(37,192,109,.18), transparent 60%),
                  radial-gradient(1200px 800px at 80% 10%, rgba(59,130,246,.18), transparent 60%),
                  linear-gradient(180deg, #020614, #050b15 55%, #020614);
      min-height:100vh; display:flex; justify-content:center; padding:32px 16px;
    }
    .wrap{width:min(1080px,100%);}
    .top{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px;}
    .brand{display:flex; gap:10px; align-items:center; opacity:.95}
    .pill{border:1px solid var(--bd); background:rgba(255,255,255,.04); padding:8px 12px; border-radius:999px; font-size:13px; color:var(--mut)}
    .hero{border:1px solid var(--bd); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-radius:18px; padding:20px; margin-bottom:16px;
    }
    .hero h1{margin:0 0 6px; font-size:24px}
    .hero p{margin:0; color:var(--mut); line-height:1.6}
    .grid{display:grid; grid-template-columns:1.15fr .85fr; gap:14px;}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr;} }
    .card{border:1px solid var(--bd); background:var(--card); border-radius:18px; padding:16px;}
    .card h2{margin:0 0 10px; font-size:16px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media (max-width: 520px){ .row{grid-template-columns:1fr;} }
    label{font-size:12px; color:var(--mut); display:block; margin:8px 0 6px;}
    input{
      width:100%; box-sizing:border-box; border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25); color:var(--txt);
      padding:12px 12px; outline:none;
    }
    input:focus{border-color:rgba(59,130,246,.55); box-shadow:0 0 0 3px rgba(59,130,246,.18)}
    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;}
    button{
      border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06);
      color:var(--txt); padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:600;
    }
    button.primary{background:linear-gradient(90deg, rgba(37,192,109,.85), rgba(59,130,246,.85)); border:none;}
    button.danger{background:rgba(255,91,91,.16); border-color:rgba(255,91,91,.30);}
    .status{margin-top:12px; padding:10px 12px; border-radius:12px; border:1px dashed rgba(255,255,255,.18); color:var(--mut);}
    .kpi{display:grid; gap:10px;}
    .kpiBox{border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18); border-radius:14px; padding:12px;}
    .kpiBox .t{font-size:12px; color:var(--mut)}
    .kpiBox .v{font-size:22px; font-weight:800; margin-top:4px}
    .bar{height:10px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden; margin-top:10px}
    .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg, rgba(37,192,109,.9), rgba(59,130,246,.9));}
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);}
    th,td{padding:10px; font-size:13px; color:var(--mut); border-bottom:1px solid rgba(255,255,255,.08);}
    th{color:#dfe8ff; text-align:left; font-weight:700;}
    tr:last-child td{border-bottom:none;}
    .rightTop{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .hello{font-size:13px; color:var(--mut)}
    .small{font-size:12px; color:var(--mut)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div style="font-weight:900;">ğŸª Mark Money Lifeï½œæŠ•è³‡æ˜ŸçƒåŸºåœ°</div>
        <div class="pill">Hub v1 Stable</div>
      </div>
      <div class="pill">slug å»ºè­°ï¼šinvest-base / dividend-base / starbase</div>
    </div>

    <div class="hero">
      <h1>æŠ•è³‡æ˜ŸçƒåŸºåœ°ï¼ˆé…æ¯ç´€éŒ„å„€è¡¨æ¿ï¼‰</h1>
      <p>é€™è£¡ä¸æ˜¯ã€Œå·¥å…·ã€ï¼Œæ˜¯ä½ æœƒå›ä¾†çœ‹çš„åŸºåœ°ã€‚<br/>
      æœƒè¨˜ä½ä½ çš„è¨­å®šï¼ˆLocalStorageï¼‰ï¼Œä¸¦å˜—è©¦åŒæ­¥åˆ° Google Sheetï¼›å°±ç®— Sheet æ›äº†ï¼Œä½ æœ¬æ©Ÿç´€éŒ„ä¹Ÿé‚„åœ¨ã€‚</p>
    </div>

    <div class="grid">
      <div class="card">
        <h2>ç¬¬ä¸€æ¬¡ä¾†ï¼šè¨­å®šï¼›ä¹‹å¾Œæ¯æœˆï¼šæ–°å¢ç´€éŒ„</h2>

        <label>user_keyï¼ˆEmail / æš±ç¨± / UIDï¼‰</label>
        <input id="userKey" placeholder="ä¾‹å¦‚ï¼šmark_test / 513" />

        <div class="row">
          <div>
            <label>å¹´åº¦é…æ¯ç›®æ¨™ï¼ˆå…ƒï¼‰</label>
            <input id="goal" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š300000" />
          </div>
          <div>
            <label>ç´€éŒ„æœˆä»½ï¼ˆYYYY-MMï¼‰</label>
            <input id="month" placeholder="ä¾‹å¦‚ï¼š2025-12" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>æœ¬æœˆé…æ¯ï¼ˆå…ƒï¼‰</label>
            <input id="thisMonth" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š18000" />
          </div>
          <div>
            <label>å¹´åº¦é…æ¯ç´¯ç© YTDï¼ˆå…ƒï¼‰</label>
            <input id="ytd" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š120000" />
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="btnSave">å„²å­˜è¨­å®šï¼ˆæœ¬æ©Ÿï¼‹åŒæ­¥ï¼‰</button>
          <button id="btnAdd">æ–°å¢æœ¬æœˆç´€éŒ„ï¼ˆæœ¬æ©Ÿï¼‹åŒæ­¥ï¼‰</button>
          <button id="btnDemo">ç¤ºç¯„è³‡æ–™</button>
          <button class="danger" id="btnClear">æ¸…é™¤æœ¬æ©Ÿè³‡æ–™</button>
        </div>

        <div class="status" id="status">ç‹€æ…‹ï¼šå°šæœªè¨­å®š</div>

        <div style="margin-top:12px">
          <div style="font-weight:800; margin-bottom:8px;">ğŸ“¦ å‚™ä»½ / é‚„åŸï¼ˆåŒ¯å‡º / åŒ¯å…¥ JSONï¼‰</div>
          <div class="btns">
            <button id="btnExport">åŒ¯å‡º JSON</button>
            <button id="btnImport">åŒ¯å…¥ JSON</button>
          </div>
          <label class="small">é€™è£¡æœƒé¡¯ç¤ºåŒ¯å‡ºçš„ JSONï¼Œä¹Ÿå¯è²¼ä¸ŠåŒ¯å…¥ã€‚</label>
          <textarea id="jsonBox" style="width:100%;min-height:160px;border-radius:14px;padding:12px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.10);color:var(--txt);"></textarea>
        </div>
      </div>

      <div class="card">
        <div class="rightTop">
          <h2 style="margin:0">æœ¬æœˆèˆ‡å¹´åº¦ KPI</h2>
          <div class="hello" id="hello">ğŸ‘‹ ä½ å¥½ï¼</div>
        </div>

        <div class="kpi" style="margin-top:10px">
          <div class="kpiBox">
            <div class="t">æœ¬æœˆé…æ¯</div>
            <div class="v" id="kpiThisMonth">â€”</div>
            <div class="small" id="kpiMonthLabel">â€”</div>
          </div>
          <div class="kpiBox">
            <div class="t">å¹´åº¦é…æ¯ç´¯ç©ï¼ˆYTDï¼‰</div>
            <div class="v" id="kpiYTD">â€”</div>
          </div>
          <div class="kpiBox">
            <div class="t">è·é›¢ç›®æ¨™é‚„å·®</div>
            <div class="v" id="kpiRemain">â€”</div>
            <div class="small" id="kpiGapPct">â€”</div>
            <div class="bar"><i id="bar"></i></div>
          </div>
        </div>

        <div style="margin-top:14px">
          <h2 style="margin:0 0 10px;">ğŸ§¾ è¨˜éŒ„ç‰†ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰</h2>
          <table>
            <thead>
              <tr>
                <th>æœˆä»½</th><th>æœ¬æœˆ</th><th>YTD</th><th>å·®ç•°</th><th>é”æˆ</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="5">å°šç„¡ç´€éŒ„ã€‚æ–°å¢ä¸€ç­†å¾Œï¼Œé€™è£¡æœƒè®Šæˆä½ çš„æ™‚é–“ç·šã€‚</td></tr>
            </tbody>
          </table>
          <div class="btns" style="justify-content:flex-end;">
            <button class="danger" id="btnDelLast">åˆªé™¤æœ€å¾Œä¸€ç­†</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/** ===========================
 *  ä½ è¦æ”¹çš„åªæœ‰é€™å…©å€‹
 * =========================== */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxRmQJuLaKzmp76nIHS6upbokDZY-8eIDdtYvx_2SX2ivgx51sIVPP9zjf_YEPXQWbe/exec";
const API_TOKEN  = "MML_SECRET_123";

/** ===========================
 *  LocalStorage key
 * =========================== */
const LS_KEY = "mml_invest_base_v1";

const $ = (id) => document.getElementById(id);

const fmt = (n) => {
  const x = Number(n);
  if (!isFinite(x)) return "â€”";
  return x.toLocaleString("zh-Hant-TW") + " å…ƒ";
};
const num = (v) => {
  const x = Number(String(v ?? "").replace(/[,\s]/g,""));
  return isFinite(x) ? x : 0;
};
const monthDefault = () => {
  const d = new Date();
  const m = String(d.getMonth()+1).padStart(2,"0");
  return `${d.getFullYear()}-${m}`;
};

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    return raw ? JSON.parse(raw) : { user_key:"", goal:0, history:[] };
  }catch(e){
    return { user_key:"", goal:0, history:[] };
  }
}
function saveState(state){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

function setStatus(msg, type="mut"){
  const el = $("status");
  const icon = type==="ok" ? "âœ…" : type==="warn" ? "âš ï¸" : type==="bad" ? "âŒ" : "â„¹ï¸";
  el.textContent = `ç‹€æ…‹ï¼š${icon} ${msg}`;
}

function render(){
  const st = loadState();

  $("userKey").value = st.user_key || "";
  $("goal").value = st.goal ? String(st.goal) : "";
  if (!$("month").value) $("month").value = monthDefault();

  $("hello").textContent = `ğŸ‘‹ ${st.user_key ? st.user_key : "ä½ å¥½"}ï¼`;

  // KPI ç”¨æœ€å¾Œä¸€ç­†ç´€éŒ„ç•¶æœ¬æœˆé¡¯ç¤º
  const last = st.history?.[0];
  const thisMonth = last ? num(last.this_month_div) : 0;
  const ytd = last ? num(last.ytd_div) : 0;
  const goal = num(st.goal);

  $("kpiThisMonth").textContent = last ? fmt(thisMonth) : "â€”";
  $("kpiMonthLabel").textContent = last ? `ç´€éŒ„æœˆä»½ï¼š${last.month}` : "â€”";
  $("kpiYTD").textContent = last ? fmt(ytd) : "â€”";

  const remain = Math.max(0, goal - ytd);
  $("kpiRemain").textContent = goal ? fmt(remain) : "â€”";

  const pct = goal ? Math.min(1, ytd/goal) : 0;
  $("bar").style.width = `${Math.round(pct*100)}%`;
  $("kpiGapPct").textContent = goal ? `å·²é”æˆ ${Math.round(pct*100)}%` : "å…ˆè¨­å®šå¹´åº¦ç›®æ¨™";

  // table
  const tb = $("tbody");
  tb.innerHTML = "";
  const list = (st.history || []).slice(0,10);
  if (!list.length){
    tb.innerHTML = `<tr><td colspan="5">å°šç„¡ç´€éŒ„ã€‚æ–°å¢ä¸€ç­†å¾Œï¼Œé€™è£¡æœƒè®Šæˆä½ çš„æ™‚é–“ç·šã€‚</td></tr>`;
  } else {
    list.forEach((r, idx) => {
      const goal = num(st.goal);
      const ytd = num(r.ytd_div);
      const gap = Math.max(0, goal - ytd);
      const done = goal ? Math.round(Math.min(1, ytd/goal)*100) + "%" : "â€”";
      tb.insertAdjacentHTML("beforeend", `
        <tr>
          <td>${r.month}</td>
          <td>${num(r.this_month_div).toLocaleString()}</td>
          <td>${num(r.ytd_div).toLocaleString()}</td>
          <td>${goal ? gap.toLocaleString() : "â€”"}</td>
          <td>${done}</td>
        </tr>
      `);
    });
  }
}

/** ===========================
 *  âœ… æœ€é—œéµï¼šåŒæ­¥åˆ° Google Sheetï¼ˆä¸å†è¢« < ç‚¸æ‰ï¼‰
 *  - å…ˆæ‹¿ text() å†åˆ¤æ–·æ˜¯å¦ JSON
 *  - å¦‚æœæ‹¿åˆ° HTMLï¼ˆ<...ï¼‰ï¼ŒæŠŠå‰ 200 å­—ä¸Ÿåˆ°ç‹€æ…‹æ¬„
 * =========================== */
async function syncToSheet(payload){
  try{
    const res = await fetch(WEBAPP_URL, {
      method: "POST",
      headers: { "Content-Type":"text/plain;charset=utf-8" },
      body: JSON.stringify({ token: API_TOKEN, ...payload })
    });

    const text = await res.text();

    // 1) æœ€å¸¸è¦‹ï¼šæ‹¿åˆ° HTMLï¼ˆç™»å…¥é /æ¬Šé™é /éŒ¯èª¤é ï¼‰
    if (text.trim().startsWith("<")) {
      setStatus("åŒæ­¥å¤±æ•—ï¼šWeb App å›å‚³çš„æ˜¯ HTMLï¼ˆé€šå¸¸æ˜¯éƒ¨ç½²æ¬Šé™/éœ€è¦ç™»å…¥ï¼‰ã€‚è«‹æŠŠéƒ¨ç½²æ”¹æˆã€ä»¥æˆ‘åŸ·è¡Œã€ï¼‹ã€ä»»ä½•äººå¯å­˜å–ã€ã€‚", "warn");
      console.warn("HTML response:", text.slice(0, 500));
      return { ok:false, raw:text };
    }

    // 2) æ­£å¸¸ï¼šJSON
    let data;
    try { data = JSON.parse(text); }
    catch(e){
      setStatus("åŒæ­¥å¤±æ•—ï¼šå›å‚³ä¸æ˜¯ JSONï¼ˆè«‹çœ‹ consoleï¼‰ã€‚", "warn");
      console.warn("Non-JSON response:", text);
      return { ok:false, raw:text };
    }

    if (data && data.ok){
      setStatus("å·²åŒæ­¥ Google Sheet âœ…", "ok");
    } else {
      setStatus("åŒæ­¥å¤±æ•—ï¼šAPI å›å‚³ ok=falseï¼ˆè«‹çœ‹ consoleï¼‰ã€‚", "warn");
      console.warn("API error:", data);
    }
    return data;

  }catch(err){
    setStatus("åŒæ­¥å¤±æ•—ï¼šç¶²è·¯éŒ¯èª¤æˆ– CORS/éƒ¨ç½²å•é¡Œï¼ˆè«‹çœ‹ consoleï¼‰ã€‚", "bad");
    console.error(err);
    return { ok:false, error:String(err) };
  }
}

/** ===========================
 *  Actions
 * =========================== */
$("btnDemo").addEventListener("click", () => {
  $("userKey").value = "mark_test";
  $("goal").value = "300000";
  $("month").value = monthDefault();
  $("thisMonth").value = "18000";
  $("ytd").value = "120000";
  setStatus("å·²å¡«å…¥ç¤ºç¯„è³‡æ–™", "ok");
});

$("btnClear").addEventListener("click", () => {
  localStorage.removeItem(LS_KEY);
  $("jsonBox").value = "";
  setStatus("å·²æ¸…é™¤æœ¬æ©Ÿè³‡æ–™", "ok");
  render();
});

$("btnExport").addEventListener("click", () => {
  $("jsonBox").value = localStorage.getItem(LS_KEY) || "";
  setStatus("å·²åŒ¯å‡º JSONï¼ˆå¯å‚™ä»½ï¼‰", "ok");
});

$("btnImport").addEventListener("click", () => {
  try{
    const obj = JSON.parse($("jsonBox").value || "{}");
    localStorage.setItem(LS_KEY, JSON.stringify(obj));
    setStatus("å·²åŒ¯å…¥ JSONï¼ˆæœ¬æ©Ÿè³‡æ–™å·²é‚„åŸï¼‰", "ok");
    render();
  }catch(e){
    setStatus("JSON æ ¼å¼ä¸åˆæ³•ï¼ŒåŒ¯å…¥å¤±æ•—", "bad");
  }
});

$("btnDelLast").addEventListener("click", () => {
  const st = loadState();
  if (!st.history?.length) return setStatus("æ²’æœ‰å¯åˆªé™¤çš„ç´€éŒ„", "warn");
  st.history.shift();
  saveState(st);
  setStatus("å·²åˆªé™¤æœ€å¾Œä¸€ç­†", "ok");
  render();
});

$("btnSave").addEventListener("click", async () => {
  const st = loadState();
  st.user_key = $("userKey").value.trim();
  st.goal = num($("goal").value);
  saveState(st);
  render();

  // åŒæ­¥ï¼ˆåªé€è¨­å®šï¼‰
  const payload = {
    type: "settings",
    user_key: st.user_key,
    goal_annual_div: st.goal,
  };
  const r = await syncToSheet(payload);
  if (!r?.ok) setStatus("è¨­å®šå·²å­˜æœ¬æ©Ÿï¼Œä½†åŒæ­¥ Google Sheet å¤±æ•—ï¼ˆè«‹æª¢æŸ¥ token/éƒ¨ç½²æ¬Šé™ï¼‰", "warn");
});

$("btnAdd").addEventListener("click", async () => {
  const st = loadState();
  st.user_key = $("userKey").value.trim();
  st.goal = num($("goal").value);

  const rec = {
    month: ($("month").value || monthDefault()).trim(),
    this_month_div: num($("thisMonth").value),
    ytd_div: num($("ytd").value),
    created_at: new Date().toISOString()
  };

  st.history = [rec, ...(st.history || [])];
  saveState(st);
  render();

  // åŒæ­¥ï¼ˆé€ç´€éŒ„ï¼‰
  const payload = {
    type: "record",
    user_key: st.user_key,
    month: rec.month,
    this_month_div: rec.this_month_div,
    ytd_div: rec.ytd_div,
    goal_annual_div: st.goal
  };

  const r = await syncToSheet(payload);
  if (!r?.ok) setStatus("ç´€éŒ„å·²å­˜æœ¬æ©Ÿï¼Œä½†åŒæ­¥ Google Sheet å¤±æ•—ï¼ˆè«‹æª¢æŸ¥ token/éƒ¨ç½²æ¬Šé™ï¼‰", "warn");
});

render();
</script>
</body>
</html>
