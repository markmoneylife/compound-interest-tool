<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç†è²¡æŠ“æ¼è¨˜å¸³å°å·¥å…·ï½œå¹¸ç¦ç†è²¡å®¶æœƒå“¡ç‰ˆ</title>

  <style>
    :root {
      --green: #1D4A35;
      --yellow: #FFD54F;
      --bg: #F5F2E9;
      --red: #C0392B;
      --gray: #666;
      --card: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "Microsoft JhengHei", system-ui, sans-serif;
      background-color: var(--bg);
      color: #222;
    }

    .page {
      max-width: 1150px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3rem;
    }

    header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    header h1 {
      margin: 0.5rem 0;
      font-size: 1.8rem;
      color: var(--green);
      letter-spacing: 0.06em;
    }

    header p {
      margin: 0.25rem 0;
      color: var(--gray);
      font-size: 0.95rem;
    }

    .tagline-row {
      margin-top: 0.5rem;
      display: flex;
      justify-content: center;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .tag-pill {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      background-color: var(--yellow);
      color: #1A1A1A;
      font-weight: 600;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .tag-pill.secondary {
      background-color: #fff;
      border: 1px dashed var(--green);
      color: var(--green);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background-color: var(--card);
      border-radius: 1rem;
      padding: 1rem 1.25rem 1.25rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }

    .card h2 {
      margin: 0 0 0.4rem;
      font-size: 1.15rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .card h2 span.badge {
      font-size: 0.75rem;
      padding: 0.05rem 0.5rem;
      border-radius: 999px;
      background-color: var(--green);
      color: #fff;
    }

    .card small {
      display: block;
      margin-bottom: 0.75rem;
      font-size: 0.8rem;
      color: var(--gray);
    }

    .section-title {
      font-weight: 700;
      font-size: 0.8rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin: 0.1rem 0 0.35rem;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 0.4rem;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .field-row label {
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .field-row input[type="number"],
    .field-row input[type="text"] {
      width: 100%;
      padding: 0.35rem 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ddd;
      font-size: 0.9rem;
    }

    .field-row input[type="number"]:focus,
    .field-row input[type="text"]:focus {
      outline: none;
      border-color: var(--green);
      box-shadow: 0 0 0 2px rgba(29, 74, 53, 0.15);
    }

    .field-row.dynamic {
      grid-template-columns: 1.3fr 1fr auto;
    }

    .field-row.dynamic input[type="text"] {
      font-size: 0.85rem;
    }

    .add-btn {
      margin-top: 0.25rem;
      font-size: 0.8rem;
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      border: 1px dashed #ccc;
      background-color: #fafafa;
      cursor: pointer;
      color: #555;
    }

    .add-btn:hover {
      border-color: var(--green);
      color: var(--green);
    }

    .sample-link {
      display: inline-flex;
      margin-top: 0.5rem;
      font-size: 0.8rem;
      background: none;
      border: none;
      padding: 0;
      color: var(--green);
      cursor: pointer;
      text-decoration: underline;
    }

    .sample-link:hover {
      opacity: 0.85;
    }

    .remove-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.75rem;
      color: #aaa;
      padding: 0.15rem 0.35rem;
    }

    .remove-btn:hover {
      color: var(--red);
    }

    .btn-area {
      text-align: center;
      margin: 1.5rem 0 1rem;
    }

    button#calcBtn {
      background-color: var(--green);
      color: #fff;
      border: none;
      padding: 0.7rem 1.8rem;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.1s;
    }

    button#calcBtn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.18);
      background-color: #236247;
    }

    button#calcBtn:active {
      transform: translateY(0);
      box-shadow: 0 3px 7px rgba(0,0,0,0.16);
    }

    .result-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
      gap: 1rem;
      align-items: flex-start;
    }

    @media (max-width: 768px) {
      .result-grid {
        grid-template-columns: 1fr;
      }
    }

    .results-card {
      background-color: #ffffff;
      border-radius: 1rem;
      padding: 1rem 1.25rem 1.25rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .results-card h3 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      font-size: 1.05rem;
      color: var(--green);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .results-card h3 span.flag {
      font-size: 0.78rem;
      background-color: #fff5cc;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      color: #8a6d1f;
      border: 1px solid #f0d67e;
    }

    .results-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.9rem;
    }

    .results-list li {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px dashed #eee;
    }

    .results-list li span.label {
      color: var(--gray);
    }

    .results-list li span.value {
      font-weight: 600;
    }

    .results-list li.strong span.value {
      color: var(--green);
      font-size: 1rem;
    }

    .results-list li.mark-rule span.value.pass {
      color: #1e8449;
      font-weight: 700;
    }

    .results-list li.mark-rule span.value.fail {
      color: var(--red);
      font-weight: 700;
    }

    .hint {
      margin-top: 0.4rem;
      font-size: 0.8rem;
      color: var(--gray);
    }

    .hint span {
      font-weight: 600;
      color: var(--green);
    }

    .warning {
      color: var(--red);
      font-weight: 600;
    }

    .input-error {
      border-color: var(--red) !important;
      box-shadow: 0 0 0 2px rgba(192,57,43,0.15) !important;
    }

    /* æ”¶å…¥åˆ†é…æ¢ */
    .bar-wrapper {
      margin-top: 0.6rem;
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background-color: #eee;
      overflow: hidden;
      display: flex;
    }

    .bar {
      height: 100%;
      transition: width 0.2s ease;
    }

    .bar-fixed { background-color: #c8e6c9; }
    .bar-ent { background-color: #ffe082; }
    .bar-saving { background-color: #80cbc4; }

    .bar-note {
      margin-top: 0.3rem;
      font-size: 0.78rem;
      color: var(--gray);
    }

    .bubble {
      position: relative;
      background-color: var(--green);
      color: #fff;
      border-radius: 1rem;
      padding: 0.9rem 1rem;
      font-size: 0.9rem;
      line-height: 1.5;
      box-shadow: 0 4px 10px rgba(0,0,0,0.16);
    }

    .bubble::before {
      content: "";
      position: absolute;
      left: 1.5rem;
      bottom: -8px;
      border-width: 8px 8px 0 8px;
      border-style: solid;
      border-color: var(--green) transparent transparent transparent;
    }

    .bubble-title {
      font-weight: 700;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .bubble-title span {
      font-size: 0.8rem;
      background-color: rgba(0,0,0,0.2);
      border-radius: 999px;
      padding: 0 0.4rem;
    }

    .summary-text {
      margin: 0.1rem 0 0.4rem;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .bubble ul {
      padding-left: 1.1rem;
      margin: 0.25rem 0 0;
    }

    .bubble li {
      margin-bottom: 0.1rem;
    }

    .next-step {
      margin-top: 0.75rem;
      font-size: 0.85rem;
    }

    .cta-btn {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      background-color: var(--yellow);
      color: #1A1A1A;
      text-decoration: none;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .cta-btn:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>ç†è²¡æŠ“æ¼è¨˜å¸³å°å·¥å…·</h1>
      <p>è¼¸å…¥ä½ ç¾åœ¨çš„æœˆæ”¶å…¥èˆ‡æ”¯å‡ºï¼Œçœ‹çœ‹éŒ¢éƒ½èŠ±å»å“ªã€å„²è“„ç‡å¤ ä¸å¤ åŠ›ã€‚</p>
      <div class="tagline-row">
        <div class="tag-pill">æœƒå“¡å¯¦æˆ°ç‰ˆï½œæ•¸å­—åªçµ¦è‡ªå·±çœ‹</div>
        <div class="tag-pill secondary">é¦¬å…‹ç†å¿µï¼šæŠ•è³‡é”åˆ° 30%ï¼Œå‰©ä¸‹æ€éº¼èŠ±éƒ½å¯ä»¥</div>
      </div>
    </header>

    <!-- ====== è¼¸å…¥å€ ====== -->
    <div class="grid">
      <!-- æ”¶å…¥ -->
      <section class="card">
        <h2>ğŸ’° æ”¶å…¥ <span class="badge">æ¯æœˆ</span></h2>
        <small>å…ˆæŠŠæœ€å¸¸è¦‹çš„æ”¶å…¥å¡«ä¸Šå»ï¼Œè‹¥æœ‰çé‡‘ã€å…¼è·ï¼Œå¯ä»¥å¡«åœ¨ã€Œå…¶ä»–æ”¶å…¥ã€ã€‚</small>

        <div class="section-title">æ”¶å…¥é …ç›®</div>

        <div class="field-row">
          <label for="incomeSalary">è–ªæ°´</label>
          <input id="incomeSalary" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š31000" />
        </div>

        <div class="field-row">
          <label for="incomeOther">å…¶ä»–æ”¶å…¥</label>
          <input id="incomeOther" type="number" min="0" placeholder="æ¥æ¡ˆã€å…¼è·ã€çé‡‘â€¦" />
        </div>

        <button type="button" class="sample-link" onclick="applySample()">
          ğŸ‘‰ ä¸çŸ¥é“æ€éº¼å¡«ï¼Ÿå¥—ç”¨ 30K å°è³‡ç¤ºç¯„æ•¸å­—
        </button>
      </section>

      <!-- å›ºå®šæ”¯å‡º -->
      <section class="card">
        <h2>ğŸ  å›ºå®šæ”¯å‡º <span class="badge">æ¯æœˆ</span></h2>
        <small>æ¯å€‹æœˆä¸€å®šæœƒä»˜çš„éŒ¢ï¼šæˆ¿ç§Ÿã€äº¤é€šã€å¸³å–®â€¦è‡³å°‘å…ˆå¡«ä¸€å…©é …ï¼ŒæŠ“æ¼æ‰æœ‰æ–¹å‘ã€‚</small>

        <div class="section-title">ç”Ÿæ´»å¿…è¦æ”¯å‡º</div>

        <div class="field-row">
          <label for="expFood">é¤è²»</label>
          <input id="expFood" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š8000" />
        </div>
        <div class="field-row">
          <label for="expTransport">äº¤é€šè²»</label>
          <input id="expTransport" type="number" min="0" placeholder="500" />
        </div>
        <div class="field-row">
          <label for="expRent">æˆ¿ç§Ÿ</label>
          <input id="expRent" type="number" min="0" placeholder="6500" />
        </div>
        <div class="field-row">
          <label for="expElectric">é›»è²» / æ°´è²»</label>
          <input id="expElectric" type="number" min="0" placeholder="600" />
        </div>
        <div class="field-row">
          <label for="expLiving">ç”Ÿæ´»é›œè²»</label>
          <input id="expLiving" type="number" min="0" placeholder="599" />
        </div>
        <div class="field-row">
          <label for="expLoan">è²¸æ¬¾</label>
          <input id="expLoan" type="number" min="0" placeholder="3344" />
        </div>
        <div class="field-row">
          <label for="expCard">å¡è²»</label>
          <input id="expCard" type="number" min="0" placeholder="6000" />
        </div>

        <div id="fixed-dynamic"></div>
        <button type="button" class="add-btn" onclick="addField('fixed-dynamic')">ï¼‹ æ–°å¢å…¶ä»–å›ºå®šæ”¯å‡º</button>
      </section>

      <!-- å„²è“„ / æŠ•è³‡ -->
      <section class="card">
        <h2>ğŸ“ˆ å„²è“„ / æŠ•è³‡ <span class="badge">æ¯æœˆæ’¥å‡º</span></h2>
        <small>é€™è£¡æ˜¯ã€Œçµ¦æœªä¾†çš„è‡ªå·±ã€çš„éŒ¢ï¼ŒåŒ…å« ETFã€å®šå­˜ã€å„²è“„éšªç­‰ã€‚</small>

        <div class="section-title">å„²è“„èˆ‡æŠ•è³‡</div>

        <div class="field-row">
          <label for="saveInvest">æŠ•è³‡ï¼ˆETFã€åŸºé‡‘ç­‰ï¼‰</label>
          <input id="saveInvest" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š3000" />
        </div>
        <div class="field-row">
          <label for="saveDeposit">å®šå­˜ / å„²è“„</label>
          <input id="saveDeposit" type="number" min="0" placeholder="0" />
        </div>
        <div class="field-row">
          <label for="saveOther">å…¶ä»–å„²è“„</label>
          <input id="saveOther" type="number" min="0" placeholder="é¸å¡«" />
        </div>

        <div id="saving-dynamic"></div>
        <button type="button" class="add-btn" onclick="addField('saving-dynamic')">ï¼‹ æ–°å¢å…¶ä»–æŠ•è³‡ / å„²è“„</button>
      </section>

      <!-- å¨›æ¨‚æ€§æ¶ˆè²» -->
      <section class="card">
        <h2>ğŸ‰ å¨›æ¨‚æ€§æ¶ˆè²» <span class="badge">æ¯æœˆ</span></h2>
        <small>åƒå¥½æ–™ã€æ—…éŠã€è³¼ç‰©ã€è¨‚é–±åˆ¶éƒ½ç®—åœ¨é€™è£¡ï¼Œèª å¯¦ä¸€é»ï¼Œå·¥å…·æ‰æŠ“å¾—åˆ°æ¼ã€‚</small>

        <div class="section-title">é–‹å¿ƒèŠ±çš„éŒ¢</div>

        <div class="field-row">
          <label for="entMeal">èšé¤ / å¤–é£ŸåŠ ç¢¼</label>
          <input id="entMeal" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š3000" />
        </div>
        <div class="field-row">
          <label for="entTravel">æ—…éŠ / å‡ºéŠ</label>
          <input id="entTravel" type="number" min="0" placeholder="é¸å¡«" />
        </div>
        <div class="field-row">
          <label for="entShopping">è³¼ç‰© / 3C / è¡£æœ</label>
          <input id="entShopping" type="number" min="0" placeholder="é¸å¡«" />
        </div>
        <div class="field-row">
          <label for="entSub">è¨‚é–± / å½±åŠ‡ / éŠæˆ²</label>
          <input id="entSub" type="number" min="0" placeholder="é¸å¡«" />
        </div>

        <div id="ent-dynamic"></div>
        <button type="button" class="add-btn" onclick="addField('ent-dynamic')">ï¼‹ æ–°å¢å…¶ä»–å¨›æ¨‚æ”¯å‡º</button>
      </section>

      <!-- å¹´åº¦æ”¯å‡º -->
      <section class="card">
        <h2>ğŸ“… å¹´åº¦æ”¯å‡º <span class="badge">å¹´ç¹³</span></h2>
        <small>ä¸€å¹´ä»˜ä¸€æ¬¡ï¼Œä½†æœ¬è³ªä¸Šä¹Ÿæ˜¯æ”¯å‡ºã€‚æœƒè‡ªå‹•æŠ˜ç®—æˆã€Œæ¯æœˆæ‡‰é ç•™ã€çš„é‡‘é¡ã€‚</small>

        <div class="section-title">ä¸€å¹´ä¸€æ¬¡çš„å¤§ç­†æ”¯å‡º</div>

        <div class="field-row">
          <label for="yrInsurance">ä¿è²»ï¼ˆå£½éšªã€é†«ç™‚éšªï¼‰</label>
          <input id="yrInsurance" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š12000" />
        </div>
        <div class="field-row">
          <label for="yrTax">æ‰€å¾—ç¨…</label>
          <input id="yrTax" type="number" min="0" placeholder="ä¾‹å¦‚ï¼š12000" />
        </div>

        <div id="yearly-dynamic"></div>
        <button type="button" class="add-btn" onclick="addField('yearly-dynamic')">ï¼‹ æ–°å¢å…¶ä»–å¹´åº¦æ”¯å‡º</button>
      </section>
    </div>

    <!-- ====== æŒ‰éˆ• ====== -->
    <div class="btn-area">
      <button id="calcBtn">è©¦ç®—ä¸€ä¸‹ï¼Œçœ‹çœ‹éŒ¢æœ‰æ²’æœ‰æ¼ ğŸŒŠ</button>
    </div>

    <!-- ====== çµæœå€ ====== -->
    <section class="result-grid">
      <!-- æ•¸å­—çµæœ -->
      <div class="results-card">
        <h3>
          ğŸ“Š æ•¸å­—ç¸½æ•´ç†
          <span class="flag">å…ˆæŠ•è³‡ï¼Œå†äº«å—</span>
        </h3>
        <ul class="results-list">
          <li class="strong">
            <span class="label">æ¯æœˆç¸½æ”¶å…¥</span>
            <span class="value" id="resIncome">-</span>
          </li>
          <li>
            <span class="label">æ¯æœˆå›ºå®šæ”¯å‡º</span>
            <span class="value" id="resFixed">-</span>
          </li>
          <li>
            <span class="label">æ¯æœˆå¨›æ¨‚æ€§æ”¯å‡º</span>
            <span class="value" id="resEnt">-</span>
          </li>
          <li>
            <span class="label">å¹´åº¦æ”¯å‡ºæŠ˜ç®—ï¼ˆæ¯æœˆæ‡‰é ç•™ï¼‰</span>
            <span class="value" id="resYearlyMonthly">-</span>
          </li>
          <li>
            <span class="label">æ¯æœˆå„²è“„ / æŠ•è³‡é‡‘é¡ï¼ˆå«å®šå­˜ï¼‰</span>
            <span class="value" id="resSaving">-</span>
          </li>
          <li class="strong">
            <span class="label">æ¯æœˆå¯¦éš›çµé¤˜ï¼ˆæ”¶å…¥ âˆ’ æ”¯å‡º âˆ’ å„²è“„ï¼‰</span>
            <span class="value" id="resSurplus">-</span>
          </li>
          <li>
            <span class="label">æ•´é«”å„²è“„ç‡ï¼ˆå„²è“„ Ã· æ”¶å…¥ï¼‰</span>
            <span class="value" id="resSavingRate">-</span>
          </li>
          <li>
            <span class="label">å›ºå®šæ”¯å‡ºä½”æ¯”</span>
            <span class="value" id="resFixedRate">-</span>
          </li>
          <li>
            <span class="label">å¨›æ¨‚æ”¯å‡ºä½”æ¯”</span>
            <span class="value" id="resEntRate">-</span>
          </li>
          <li class="mark-rule">
            <span class="label">é¦¬å…‹ 30% æŠ•è³‡æŒ‡æ¨™ï¼ˆç´”æŠ•è³‡ Ã· æ”¶å…¥ï¼‰</span>
            <span class="value" id="resInvestRate">-</span>
          </li>
        </ul>

        <p id="investGapText" class="hint"></p>

        <div class="bar-wrapper">
          <div class="bar bar-fixed" id="barFixed"></div>
          <div class="bar bar-ent" id="barEnt"></div>
          <div class="bar bar-saving" id="barSaving"></div>
        </div>
        <p class="bar-note">
          ä»¥ã€Œæ”¶å…¥ = 100%ã€ç‚ºåŸºæº–ï¼Œçœ‹çœ‹éŒ¢è¢«åˆ†é…åˆ°å›ºå®šæ”¯å‡ºã€å¨›æ¨‚èˆ‡å„²è“„ / æŠ•è³‡çš„æ¯”ä¾‹ã€‚
        </p>

        <p class="hint">
          å°æé†’ï¼šçµé¤˜ç‚ºæ­£ï¼Œä»£è¡¨ä½ æ¯æœˆé‚„æœ‰<span>è£•åº¦å¯ä»¥èª¿é…</span>ï¼›çµé¤˜æ˜¯è² æ•¸ï¼Œå°±ä»£è¡¨çœŸçš„ã€Œæ¼ã€äº†ï¼Œè¦æª¢æŸ¥çœ‹å“ªä¸€å€å¤±æ§ã€‚ç´…è‰²æ•¸å­—ä¸æ˜¯è‚¡å¸‚å¤§è·Œï¼Œæ˜¯åœ¨æé†’ä½ ç¾é‡‘æµæœ‰é»å±éšªã€‚
        </p>
      </div>

      <!-- æŠ“æ¼å»ºè­°æ³¡æ³¡ -->
      <div>
        <div class="bubble" id="adviceBubble">
          <div class="bubble-title">
            æŠ“æ¼å°çµè«–
            <span>è©¦ç®—å¾Œæœƒè‡ªå‹•æ›´æ–°</span>
          </div>
          <p class="summary-text" id="adviceSummary">
            å…ˆè¼¸å…¥ä¸Šé¢çš„æ•¸å­—ï¼Œå†æŒ‰ã€Œè©¦ç®—ä¸€ä¸‹ã€ï¼Œæˆ‘æœƒç”¨ 30% æº–å‰‡å¹«ä½ çœ‹è²¡å‹™æœ‰æ²’æœ‰èµ°æ­ªã€‚
          </p>
          <ul id="adviceList">
            <li>ç›®å‰å°šæœªå¡«å¯«æ•¸æ“šï¼Œå»ºè­°å…ˆè¼¸å…¥æ”¶å…¥èˆ‡å¹¾é …ä¸»è¦æ”¯å‡ºï¼Œæ‰çœ‹å¾—å‡ºç¾é‡‘æµç‹€æ³ã€‚</li>
          </ul>
        </div>
        <div id="nextStepArea" class="next-step"></div>
      </div>
    </section>
  </div>

  <script>
    const STORAGE_KEY = "markMoney_leakTool_v1";
    const PERSIST_IDS = [
      "incomeSalary","incomeOther",
      "expFood","expTransport","expRent","expElectric","expLiving","expLoan","expCard",
      "saveInvest","saveDeposit","saveOther",
      "entMeal","entTravel","entShopping","entSub",
      "yrInsurance","yrTax"
    ];

    // å–æ•¸å€¼ï¼šç©ºç™½å°±ç•¶ 0
    function n(id) {
      const el = document.getElementById(id);
      if (!el) return 0;
      const v = parseFloat(el.value);
      return isNaN(v) ? 0 : v;
    }

    function formatMoney(num) {
      return num.toLocaleString("zh-TW", { maximumFractionDigits: 0 });
    }

    function formatPercent(num) {
      return num.toFixed(1) + "%";
    }

    // å‹•æ…‹æ¬„ä½ï¼šæ–°å¢
    function addField(containerId) {
      const container = document.getElementById(containerId);
      const row = document.createElement("div");
      row.className = "field-row dynamic";
      row.innerHTML = `
        <input type="text" placeholder="é …ç›®åç¨±" class="dyn-name" />
        <input type="number" placeholder="é‡‘é¡" class="dyn-value" min="0" />
        <button type="button" class="remove-btn" onclick="this.parentNode.remove(); runCalc();">âœ•</button>
      `;
      container.appendChild(row);

      const valueInput = row.querySelector(".dyn-value");
      valueInput.addEventListener("input", runCalc);
    }

    // å‹•æ…‹æ¬„ä½ï¼šåŠ ç¸½
    function sumDynamic(containerId) {
      const rows = document.querySelectorAll(`#${containerId} .dyn-value`);
      let sum = 0;
      rows.forEach((el) => {
        const v = parseFloat(el.value);
        if (!isNaN(v)) sum += v;
      });
      return sum;
    }

    function collectData() {
      const income = n("incomeSalary") + n("incomeOther");

      const fixed =
        n("expFood") +
        n("expTransport") +
        n("expRent") +
        n("expElectric") +
        n("expLiving") +
        n("expLoan") +
        n("expCard") +
        sumDynamic("fixed-dynamic");

      const invest = n("saveInvest"); // é¦¬å…‹ 30% æº–å‰‡åªçœ‹ç´”æŠ•è³‡
      const saving =
        n("saveInvest") +
        n("saveDeposit") +
        n("saveOther") +
        sumDynamic("saving-dynamic");

      const ent =
        n("entMeal") +
        n("entTravel") +
        n("entShopping") +
        n("entSub") +
        sumDynamic("ent-dynamic");

      const yearlyTotal =
        n("yrInsurance") +
        n("yrTax") +
        sumDynamic("yearly-dynamic");

      return { income, fixed, invest, saving, ent, yearlyTotal };
    }

    function calcMetrics(data) {
      const { income, fixed, invest, saving, ent, yearlyTotal } = data;

      const yearlyMonthly = yearlyTotal / 12;
      const totalSpending = fixed + ent + yearlyMonthly;
      const surplus = income - totalSpending - saving;

      const savingRate = income > 0 ? (saving / income) * 100 : 0;
      const fixedRate = income > 0 ? (fixed / income) * 100 : 0;
      const entRate = income > 0 ? (ent / income) * 100 : 0;
      const investRate = income > 0 ? (invest / income) * 100 : 0;
      const surplusRate = income > 0 ? (surplus / income) * 100 : 0;

      return {
        income,
        fixed,
        invest,
        saving,
        ent,
        yearlyTotal,
        yearlyMonthly,
        totalSpending,
        surplus,
        savingRate,
        fixedRate,
        entRate,
        investRate,
        surplusRate
      };
    }

    function renderResults(m) {
      document.getElementById("resIncome").textContent =
        m.income > 0 ? formatMoney(m.income) + " å…ƒ" : "-";
      document.getElementById("resFixed").textContent =
        m.fixed > 0 ? formatMoney(m.fixed) + " å…ƒ" : "-";
      document.getElementById("resEnt").textContent =
        m.ent > 0 ? formatMoney(m.ent) + " å…ƒ" : "-";
      document.getElementById("resYearlyMonthly").textContent =
        m.yearlyMonthly > 0
          ? formatMoney(Math.round(m.yearlyMonthly)) + " å…ƒ / æœˆ"
          : "-";
      document.getElementById("resSaving").textContent =
        m.saving > 0 ? formatMoney(m.saving) + " å…ƒ" : "-";

      const surplusEl = document.getElementById("resSurplus");
      surplusEl.textContent =
        m.income > 0 ? formatMoney(Math.round(m.surplus)) + " å…ƒ" : "-";
      surplusEl.classList.toggle("warning", m.surplus < 0);

      document.getElementById("resSavingRate").textContent =
        m.saving > 0 && m.income > 0 ? formatPercent(m.savingRate) : "-";
      document.getElementById("resFixedRate").textContent =
        m.fixed > 0 && m.income > 0 ? formatPercent(m.fixedRate) : "-";
      document.getElementById("resEntRate").textContent =
        m.ent > 0 && m.income > 0 ? formatPercent(m.entRate) : "-";

      const investRateEl = document.getElementById("resInvestRate");
      if (m.income > 0 && m.invest > 0) {
        const txt = formatPercent(m.investRate);
        investRateEl.textContent = txt;
        investRateEl.classList.remove("pass", "fail");
        if (m.investRate >= 30) {
          investRateEl.classList.add("pass");
        } else {
          investRateEl.classList.add("fail");
        }
      } else {
        investRateEl.textContent = "-";
        investRateEl.classList.remove("pass", "fail");
      }

      // æŠ•è³‡ gap é¡¯ç¤º
      const investGapEl = document.getElementById("investGapText");
      if (m.income > 0 && m.invest >= 0) {
        const targetInvest = m.income * 0.3;
        const gap = targetInvest - m.invest;
        if (gap <= 0) {
          investGapEl.textContent = "âœ” ä½ çš„ç´”æŠ•è³‡æ¯”ç‡å·²é”æˆ–è¶…é 30%ï¼Œå¯ä»¥æ¯”è¼ƒå¿ƒå®‰åœ°å®‰æ’å¨›æ¨‚èˆ‡æ—…éŠé ç®—ã€‚";
        } else {
          investGapEl.textContent =
            "è‹¥è¦é”åˆ°ã€Œ30% æŠ•è³‡æŒ‡æ¨™ã€ï¼Œæ¯æœˆé‚„éœ€è¦å¤šæŠ•å…¥ç´„ " +
            formatMoney(Math.round(gap)) +
            " å…ƒåˆ°ç´”æŠ•è³‡ï¼ˆå¦‚æŒ‡æ•¸å‹ / é«˜è‚¡æ¯ ETFï¼‰ã€‚";
        }
      } else {
        investGapEl.textContent = "";
      }

      // æ”¶å…¥åˆ†é…æ¢ï¼ˆå›ºå®š + å¨›æ¨‚ + å„²è“„ï¼‰
      const barFixed = document.getElementById("barFixed");
      const barEnt = document.getElementById("barEnt");
      const barSaving = document.getElementById("barSaving");
      if (m.income > 0) {
        let fixPct = Math.max(0, Math.min(m.fixedRate, 100));
        let entPct = Math.max(0, Math.min(m.entRate, 100 - fixPct));
        let savePct = Math.max(0, Math.min(m.savingRate, 100 - fixPct - entPct));
        barFixed.style.width = fixPct + "%";
        barEnt.style.width = entPct + "%";
        barSaving.style.width = savePct + "%";
      } else {
        barFixed.style.width = "0%";
        barEnt.style.width = "0%";
        barSaving.style.width = "0%";
      }
    }

    function getProfileText(m) {
      if (m.income <= 0) {
        return "ç›®å‰é‚„æ²’è¼¸å…¥æ”¶å…¥èˆ‡æ”¯å‡ºï¼Œå…ˆå¡«å¹¾å€‹ä¸»è¦æ¬„ä½ï¼Œæˆ‘æ‰èƒ½å¹«ä½ çœ‹ç¾é‡‘æµã€‚";
      }
      if (m.surplus < 0 && m.savingRate < 10) {
        return "ç¾é‡‘æµå±¬æ–¼ã€Œç«ç‡’å±è‚¡å‹ã€ï¼Œç›®å‰å…¥ä¸æ•·å‡ºã€å­˜çš„ä¹Ÿä¸å¤šï¼ŒçŸ­æœŸé¢¨éšªåé«˜ã€‚";
      }
      if (m.surplus < 0) {
        return "ä½ æ˜¯ã€Œæš«æ™‚å…¥ä¸æ•·å‡ºå‹ã€ï¼Œæ”¯å‡ºèˆ‡å„²è“„å£“åŠ›éƒ½åå¤§ï¼Œéœ€è¦èª¿æ•´æ”¯å‡ºçµæ§‹ã€‚";
      }
      if (m.investRate >= 30) {
        return "ä½ å·²ç¶“æ˜¯ã€Œ30% æŠ•è³‡å‹ã€ï¼Œå¯ä»¥æ¯”è¼ƒå•å¿ƒç„¡æ„§åœ°äº«å—ç”Ÿæ´»èˆ‡å¨›æ¨‚ã€‚";
      }
      if (m.savingRate >= 20 && m.investRate >= 15) {
        return "ä½ æ˜¯ã€ŒèªçœŸå­˜éŒ¢é€²éšç‰ˆã€ï¼ŒæŠ•è³‡ç¯€å¥æœ‰åœ¨è·‘ï¼Œå†å¾€ 30% é è¿‘æœƒæ›´ç©©ã€‚";
      }
      if (m.savingRate >= 10) {
        return "ä½ æ˜¯ã€Œç©©å¥å°è³‡å‹ã€ï¼Œæœ‰åœ¨å­˜éŒ¢ï¼Œä½†æŠ•è³‡æ¯”é‡é‚„æ²’å®Œå…¨ä¸Šç·šã€‚";
      }
      return "ç›®å‰æ¯”è¼ƒåƒã€Œç”Ÿæ´»å‹æ¶ˆè²»è€…ã€ï¼Œå¤šæ•¸éŒ¢èŠ±åœ¨ç•¶ä¸‹ï¼Œæœªä¾†è³‡ç”¢é‚„åœ¨æš–èº«éšæ®µã€‚";
    }

    function renderAdvice(m) {
      const adviceList = [];
      const summaryEl = document.getElementById("adviceSummary");
      const nextStepArea = document.getElementById("nextStepArea");

      summaryEl.textContent = getProfileText(m);
      nextStepArea.innerHTML = "";

      // æ²’æœ‰æ”¶å…¥å°±çµ¦æœ€åŸºæœ¬å»ºè­°
      if (m.income <= 0) {
        const initAdvice = [
          "å…ˆå¡«å¯«ã€Œè–ªæ°´ã€æˆ–ã€Œå…¶ä»–æ”¶å…¥ã€ï¼Œå†åŠ ä¸Š 2ï½3 å€‹æœ€å¤§å®—æ”¯å‡ºï¼ˆæˆ¿ç§Ÿã€é¤è²»ã€å¡è²»â€¦ï¼‰ã€‚",
          "å¦‚æœæ‡¶å¾—å¾é›¶é–‹å§‹ï¼Œå¯ä»¥å…ˆæŒ‰ã€Œå¥—ç”¨ 30K å°è³‡ç¤ºç¯„æ•¸å­—ã€ï¼Œå†æ”¹æˆæ¯”è¼ƒæ¥è¿‘è‡ªå·±çš„æƒ…æ³ã€‚",
          "è©¦ç®—å®Œä¹‹å¾Œï¼Œè¨˜å¾—è§€å¯Ÿã€Œçµé¤˜ã€å’Œã€Œç´”æŠ•è³‡æ¯”ç‡ã€ï¼Œé€™å…©å€‹æ˜¯ç¾é‡‘æµ & æ‰“åº•è³‡ç”¢çš„é—œéµã€‚"
        ];
        const adviceListEl = document.getElementById("adviceList");
        adviceListEl.innerHTML = initAdvice.map(item => "<li>" + item + "</li>").join("");
        return;
      }

      // çµé¤˜ç‹€æ³
      if (m.surplus < 0) {
        adviceList.push(
          "ä½ ç›®å‰æ¯æœˆæ˜¯ <b class='warning'>å…¥ä¸æ•·å‡º</b>ï¼Œæ”¯å‡ºï¼‹å„²è“„å·²ç¶“è¶…éæ”¶å…¥ï¼ŒçŸ­æœŸå¯èƒ½è¦é åˆ·å¡æˆ–å‹•ç”¨å­˜æ¬¾æ’è‘—ã€‚å…ˆæª¢æŸ¥å›ºå®šæ”¯å‡ºèˆ‡å¨›æ¨‚æ”¯å‡ºå“ªä¸€å¡Šå¯ä»¥ç¸®ã€‚"
        );
      } else if (m.surplus < m.income * 0.05) {
        adviceList.push(
          "ä½ æ¯æœˆçµé¤˜å¤§ç´„æ˜¯æ”¶å…¥çš„ <b>" +
          formatPercent(m.surplusRate) +
          "</b>ï¼Œç¾é‡‘æµåç·Šï¼Œé‡åˆ°çªç™¼äº‹ä»¶æœƒæ¯”è¼ƒæœ‰å£“åŠ›ã€‚å¯ä»¥è©¦è‘—æŠŠå›ºå®šæ”¯å‡ºæˆ–å¨›æ¨‚èŠ±è²»å„å‰Šä¸€é»ã€‚"
        );
      } else {
        adviceList.push(
          "ä½ æ¯æœˆé‚„æœ‰çµé¤˜ï¼Œå¤§ç´„æ˜¯æ”¶å…¥çš„ <b>" +
          formatPercent(m.surplusRate) +
          "</b>ï¼Œç®—æ˜¯æœ‰å–˜æ¯ç©ºé–“ã€‚æ¥ä¸‹ä¾†é‡é»æ˜¯æ€éº¼è®“ã€ŒæŠ•è³‡æ¯”ä¾‹ã€è®Šå¾—æ›´çµ¦åŠ›ã€‚"
        );
      }

      // å„²è“„ç‡
      if (m.saving <= 0) {
        adviceList.push(
          "ç›®å‰ã€Œæ¯æœˆå„²è“„ / æŠ•è³‡ã€æ˜¯ 0ï¼Œå»ºè­°å…ˆå¾æ”¶å…¥çš„ 5ï½10% é–‹å§‹å®šæœŸæŠ•å…¥ï¼Œä¾‹å¦‚æŒ‡æ•¸å‹ETFæˆ–é«˜è‚¡æ¯ETFï¼Œè®“æœªä¾†çš„è‡ªå·±ä¹Ÿæœ‰é ˜é…æ¯çš„ä¸€å¤©ã€‚"
        );
      } else if (m.savingRate < 10) {
        adviceList.push(
          "æ•´é«”å„²è“„ç‡ç´„ <b>" +
          formatPercent(m.savingRate) +
          "</b>ï¼Œåä½ã€‚å¯ä»¥å…ˆæŠŠå„²è“„ç‡æ‹‰åˆ° 10ï½15%ï¼Œå†æ…¢æ…¢å¾€ä¸ŠåŠ ï¼Œä¸ç”¨ä¸€æ¬¡çˆ†è¡ã€‚"
        );
      } else if (m.savingRate < 20) {
        adviceList.push(
          "æ•´é«”å„²è“„ç‡ç´„ <b>" +
          formatPercent(m.savingRate) +
          "</b>ï¼Œå·²ç¶“æœ‰åŸºæœ¬é˜²ç¦¦åŠ›äº†ï¼Œå†å¾€ 20% é è¿‘æœƒæ›´ç©©ã€‚"
        );
      } else {
        adviceList.push(
          "æ•´é«”å„²è“„ç‡ç´„ <b>" +
          formatPercent(m.savingRate) +
          "</b>ï¼Œç®—æ˜¯è »èªçœŸå­˜éŒ¢çš„ä¸€æ—ã€‚è¨˜å¾—åˆ†æ•£åœ¨æŒ‡æ•¸å‹ETFèˆ‡ç¾é‡‘é å‚™é‡‘ï¼Œä¸è¦å…¨éƒ¨å£“å–®ä¸€æ¨™çš„ã€‚"
        );
      }

      // é¦¬å…‹ 30% æŠ•è³‡æº–å‰‡
      if (m.invest <= 0) {
        adviceList.push(
          "ç›®å‰ç´”æŠ•è³‡é‡‘é¡æ˜¯ 0ã€‚è‹¥è¦å•Ÿå‹•ã€Œé¦¬å…‹ 30% æº–å‰‡ã€ï¼Œå¯ä»¥å…ˆå¾æ¯æœˆæ”¶å…¥çš„ 5ï½10% é–‹å§‹è²·æŒ‡æ•¸å‹æˆ–é«˜è‚¡æ¯ETFï¼Œå†æ…¢æ…¢å¾€ 30% æ¨é€²ã€‚"
        );
      } else if (m.investRate >= 30) {
        adviceList.push(
          "ä½ çš„ç´”æŠ•è³‡æ¯”ç‡ç´„ <b>" +
          formatPercent(m.investRate) +
          "</b>ï¼Œå·²ç¶“é”åˆ°ã€Œé¦¬å…‹ 30% æŠ•è³‡æ¨™æº–ã€ã€‚æ­å–œï¼Œä½ å¯ä»¥åæ­£è¨€é †åœ°å°è‡ªå·±èªªï¼šå‰©ä¸‹çš„éŒ¢æ€éº¼èŠ±éƒ½å¯ä»¥ï¼Œé–‹å¿ƒä¸€é»æ²’é—œä¿‚ã€‚"
        );
      } else if (m.investRate >= 20) {
        adviceList.push(
          "ä½ çš„ç´”æŠ•è³‡æ¯”ç‡ç´„ <b>" +
          formatPercent(m.investRate) +
          "</b>ï¼Œé›¢ 30% åªå·®ä¸€å°æ®µã€‚å¯ä»¥ç”¨ã€Œæ¯å¹´å¤šåŠ  2ï½5%ã€çš„æ–¹å¼æ…¢æ…¢åŠ ç¢¼ï¼Œè®“æŠ•è³‡æ¯”é‡æ„ˆä¾†æ„ˆæ¥è¿‘ä½ çš„ç›®æ¨™ã€‚"
        );
      } else {
        adviceList.push(
          "ä½ çš„ç´”æŠ•è³‡æ¯”ç‡ç´„ <b>" +
          formatPercent(m.investRate) +
          "</b>ï¼Œè·é›¢é¦¬å…‹å¿ƒä¸­çš„ 30% é‚„æœ‰ä¸€æ®µè·¯ã€‚å¯ä»¥å…ˆæŠŠæ¯æœˆéƒ¨åˆ†å¨›æ¨‚æˆ–å›ºå®šæ”¯å‡ºç§»ä¸€é»é»åˆ°æŠ•è³‡å€ï¼Œä¸ç”¨ä¸€æ¬¡æ”¹å¾ˆå¤§ï¼Œä½†è¦ç©©å®šå‰é€²ã€‚"
        );
      }

      // å›ºå®šæ”¯å‡º
      const maxFixed = 50;
      if (m.fixedRate > maxFixed) {
        adviceList.push(
          "å›ºå®šæ”¯å‡ºä½”æ”¶å…¥ç´„ <b>" +
          formatPercent(m.fixedRate) +
          "</b>ï¼Œåé«˜ã€‚å¯ä»¥æª¢æŸ¥æˆ¿ç§Ÿã€è²¸æ¬¾ã€ä¿è²»ã€é€šå‹¤æ˜¯å¦æœ‰é‡æ–°è«‡ç´„ã€æ›æ–¹æ¡ˆæˆ–æ¬å®¶èª¿æ•´çš„ç©ºé–“ã€‚"
        );
      } else {
        adviceList.push(
          "å›ºå®šæ”¯å‡ºä½”æ”¶å…¥ç´„ <b>" +
          formatPercent(m.fixedRate) +
          "</b>ï¼Œé‚„åœ¨åˆç†ç¯„åœå…§ã€‚è¨˜å¾—é¿å…å†åŠ æ–°çš„åˆ†æœŸèˆ‡è¨‚é–±ï¼Œä¸ç„¶å¹¾å€‹æœˆå¾Œå›ºå®šæ”¯å‡ºæœƒæ‚„æ‚„è†¨è„¹ã€‚"
        );
      }

      // å¨›æ¨‚æ”¯å‡º
      const maxEnt = 20;
      if (m.entRate > maxEnt) {
        adviceList.push(
          "å¨›æ¨‚æ€§æ”¯å‡ºä½”æ”¶å…¥ç´„ <b>" +
          formatPercent(m.entRate) +
          "</b>ï¼Œæœ‰é»åå¤šã€‚å¯ä»¥è©¦è©¦ã€Œä¸€åŠè¦åŠƒã€ä¸€åŠäº«å—ã€ï¼šæ¯èŠ± 1 å…ƒåœ¨å¨›æ¨‚ï¼Œå°±å¤šä¸Ÿ 1 å…ƒé€²æŠ•è³‡å¸³æˆ¶ã€‚"
        );
      } else if (m.entRate > 0) {
        adviceList.push(
          "å¨›æ¨‚æ€§æ”¯å‡ºä½”æ”¶å…¥ç´„ <b>" +
          formatPercent(m.entRate) +
          "</b>ã€‚æœ‰å¥½å¥½äº«å—ç”Ÿæ´»æ˜¯å¥½äº‹ï¼Œåªè¦æŠ•è³‡æ¯”ä¾‹æœ‰é€æ­¥å¾€ 30% é è¿‘ï¼Œå°±ä¸ç”¨å¤ªç½ªæƒ¡ã€‚"
        );
      }

      // å¹´åº¦æ”¯å‡º
      if (m.yearlyTotal > 0) {
        adviceList.push(
          "ä½ æ¯å¹´æœ‰ç´„ <b>" +
          formatMoney(Math.round(m.yearlyTotal)) +
          " å…ƒ</b> çš„å¹´åº¦æ”¯å‡ºï¼ŒæŠ˜ç®—ä¸‹ä¾†æ¯æœˆæ‡‰é ç•™ <b>" +
          formatMoney(Math.round(m.yearlyMonthly)) +
          " å…ƒ</b>ã€‚å»ºè­°ç¨ç«‹é–‹ä¸€å€‹ã€Œå¹´åº¦å¸³æˆ¶ã€å°ˆé–€å­˜é€™ç­†éŒ¢ï¼Œé¿å…åˆ°æœŸæ™‚åˆå¾—åˆ·å¡ç¡¬æ‰›ã€‚"
        );
      }

      const adviceListEl = document.getElementById("adviceList");
      adviceListEl.innerHTML = adviceList.map(item => "<li>" + item + "</li>").join("");

      // ä¸‹ä¸€æ­¥å°æµï¼šä¾æŠ•è³‡æ¯”ä¾‹åˆ†æµ
      if (m.investRate < 10) {
        nextStepArea.innerHTML = `
          æƒ³å¾é›¶é–‹å§‹æŠŠæŠ•è³‡è§€å¿µè£œèµ·ä¾†ï¼Œå¯ä»¥å…ˆé€›é€›ï¼š
          <br />
          <a class="cta-btn" target="_blank"
             href="https://markmoneylife.github.io/compound-interest-tool/newbie-village.html">
            é€²å…¥ ğŸ¡ æ–°æ‰‹æŠ•è³‡æ‘ï¼Œè£œé½ŠæŠ•è³‡åŸºæœ¬åŠŸ â†’
          </a>
        `;
      } else if (m.investRate < 30) {
        nextStepArea.innerHTML = `
          æ—¢ç„¶å·²ç¶“é–‹å§‹æŠ•è³‡ï¼Œå¯ä»¥æ­é…é…æ¯è¦–è¦ºåŒ–å·¥å…·ï¼š
          <br />
          <a class="cta-btn" target="_blank"
             href="https://markmoneylife.github.io/compound-interest-tool/etf-dividend-wall.html">
            çœ‹çœ‹ä½ çš„ ETF é…æ¯åœ–å¡ç€‘å¸ƒç‰† â†’
          </a>
        `;
      } else {
        nextStepArea.innerHTML = `
          ä½ å·²ç¶“é”åˆ° 30% æŠ•è³‡å€ï¼Œå¯ä»¥é–‹å§‹ç©ã€Œé…æ¯è¿½è¹¤ã€çš„å°å®‡å®™ï¼š
          <br />
          <a class="cta-btn" target="_blank"
             href="https://markmoneylife.github.io/compound-interest-tool/etf-tracker.html">
            ç”¨ ETF æŠ•è³‡è¿½è¹¤ç‰†ï¼Œè¨˜éŒ„ä½ æ¯æœˆé ˜å¤šå°‘ â†’
          </a>
        `;
      }
    }

    function saveForm() {
      const data = {};
      PERSIST_IDS.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
      });
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        // localStorage å¤±æ•—å°±ç®—äº†ï¼Œä¸å½±éŸ¿ä½¿ç”¨
      }
    }

    function loadForm() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        Object.keys(data).forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = data[id];
        });
      } catch (e) {
        // è§£æéŒ¯èª¤å°±ç•¥é
      }
    }

    function runCalc() {
      const salaryEl = document.getElementById("incomeSalary");
      const otherIncomeEl = document.getElementById("incomeOther");
      salaryEl.classList.remove("input-error");
      otherIncomeEl.classList.remove("input-error");

      const data = collectData();
      const metrics = calcMetrics(data);

      // åŸºæœ¬è¼¸å…¥æª¢æŸ¥
      if (metrics.income <= 0) {
        renderResults(metrics);
        renderAdvice(metrics);
        salaryEl.classList.add("input-error");
        otherIncomeEl.classList.add("input-error");
        saveForm();
        return;
      }

      renderResults(metrics);
      renderAdvice(metrics);
      saveForm();
    }

    function applySample() {
      // ä¸€çµ„ 30K å°è³‡æ—ç¤ºç¯„æ•¸å­—
      document.getElementById("incomeSalary").value = 32000;
      document.getElementById("incomeOther").value = 0;

      document.getElementById("expRent").value = 8000;
      document.getElementById("expFood").value = 8000;
      document.getElementById("expTransport").value = 1200;
      document.getElementById("expElectric").value = 800;
      document.getElementById("expLiving").value = 800;
      document.getElementById("expLoan").value = 0;
      document.getElementById("expCard").value = 3000;

      document.getElementById("saveInvest").value = 6000;
      document.getElementById("saveDeposit").value = 1000;
      document.getElementById("saveOther").value = 0;

      document.getElementById("entMeal").value = 2000;
      document.getElementById("entTravel").value = 0;
      document.getElementById("entShopping").value = 800;
      document.getElementById("entSub").value = 400;

      document.getElementById("yrInsurance").value = 12000;
      document.getElementById("yrTax").value = 6000;

      runCalc();
    }

    // ç¶å®šäº‹ä»¶
    window.addEventListener("DOMContentLoaded", function () {
      loadForm();

      // è©¦ç®—æŒ‰éˆ•
      document.getElementById("calcBtn").addEventListener("click", runCalc);

      // æ‰€æœ‰æ—¢æœ‰ number æ¬„ä½å³æ™‚è¨ˆç®—
      const numberInputs = document.querySelectorAll("input[type='number']");
      numberInputs.forEach((input) => {
        input.addEventListener("input", runCalc);
      });

      // è‹¥å·²æœ‰å­˜éçš„æ”¶å…¥è³‡æ–™ï¼Œè¼‰å…¥å¾Œç›´æ¥ç®—ä¸€æ¬¡
      const incomeFromStorage = n("incomeSalary") + n("incomeOther");
      if (incomeFromStorage > 0) {
        runCalc();
      }
    });
  </script>
</body>
</html>
